<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡‘æµæ¸¬è©¦ - åŒ—æ–—æ•™è‚²</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .card { background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%); }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen p-8">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">ğŸ’³ é‡‘æµæ¸¬è©¦é¢æ¿</h1>
        
        <!-- ç’°å¢ƒè³‡è¨Š -->
        <div class="card rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">ğŸ”§ ç’°å¢ƒè³‡è¨Š</h2>
            <div id="envInfo" class="text-gray-400">è¼‰å…¥ä¸­...</div>
        </div>
        
        <!-- æ¸¬è©¦è¨‚é–±ä»˜æ¬¾ -->
        <div class="card rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">ğŸ“¦ æ¸¬è©¦è¨‚é–±ä»˜æ¬¾</h2>
            
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-1">æ–¹æ¡ˆ</label>
                    <select id="plan" class="w-full bg-gray-800 rounded px-3 py-2">
                        <option value="standard">æ¨™æº–ç‰ˆ $99/æœˆ</option>
                        <option value="pro">å°ˆæ¥­ç‰ˆ $199/æœˆ</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-1">é€±æœŸ</label>
                    <select id="cycle" class="w-full bg-gray-800 rounded px-3 py-2">
                        <option value="monthly">æœˆç¹³</option>
                        <option value="yearly">å¹´ç¹³ (çœ17%)</option>
                    </select>
                </div>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm text-gray-400 mb-1">å„ªæƒ ç¢¼</label>
                <input type="text" id="promoCode" placeholder="LAUNCH20 / FIRST50" 
                       class="w-full bg-gray-800 rounded px-3 py-2">
            </div>
            
            <button onclick="testSubscribe()" 
                    class="w-full bg-purple-600 hover:bg-purple-700 py-3 rounded-lg font-bold transition">
                ğŸ§ª ç”¢ç”Ÿæ¸¬è©¦ä»˜æ¬¾
            </button>
        </div>
        
        <!-- æ¸¬è©¦è­‰ç…§è³¼è²· -->
        <div class="card rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">ğŸ“ æ¸¬è©¦è­‰ç…§è³¼è²·</h2>
            
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-1">è­‰ç…§</label>
                    <select id="certId" class="w-full bg-gray-800 rounded px-3 py-2">
                        <option value="google-ai">Google AI èªè­‰ $199</option>
                        <option value="aws-ai">AWS AI èªè­‰ $299</option>
                        <option value="azure-ai">Azure AI èªè­‰ $299</option>
                        <option value="ipas-security">iPAS è³‡å®‰èªè­‰ $149</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-1">ç‰ˆæœ¬</label>
                    <select id="certPro" class="w-full bg-gray-800 rounded px-3 py-2">
                        <option value="false">æ¨™æº–ç‰ˆ</option>
                        <option value="true">Proç‰ˆ (2å€åƒ¹æ ¼)</option>
                    </select>
                </div>
            </div>
            
            <button onclick="testCert()" 
                    class="w-full bg-green-600 hover:bg-green-700 py-3 rounded-lg font-bold transition">
                ğŸ§ª ç”¢ç”Ÿæ¸¬è©¦ä»˜æ¬¾
            </button>
        </div>
        
        <!-- çµæœé¡¯ç¤º -->
        <div class="card rounded-2xl p-6">
            <h2 class="text-xl font-bold mb-4">ğŸ“‹ æ¸¬è©¦çµæœ</h2>
            <pre id="result" class="bg-gray-800 p-4 rounded-lg text-sm overflow-auto max-h-96 text-green-400">
ç­‰å¾…æ¸¬è©¦...
            </pre>
            
            <div id="paymentForm" class="hidden mt-4">
                <p class="text-yellow-400 mb-2">âš ï¸ ä»¥ä¸‹ç‚ºæ²™ç®±æ¸¬è©¦ï¼Œä¸æœƒå¯¦éš›æ‰£æ¬¾</p>
                <form id="ecpayForm" method="POST" target="_blank">
                    <button type="submit" 
                            class="w-full bg-yellow-600 hover:bg-yellow-700 py-3 rounded-lg font-bold transition">
                        ğŸ”— å‰å¾€ ECPay æ²™ç®±ä»˜æ¬¾
                    </button>
                </form>
            </div>
        </div>
        
        <!-- è¿”å› -->
        <div class="text-center mt-8">
            <a href="index.html" class="text-purple-400 hover:text-purple-300">â† è¿”å›é¦–é </a>
        </div>
    </div>

    <script>
        const API_BASE = 'https://beidou-edu-server-1.onrender.com';
        // const API_BASE = 'http://localhost:10000'; // æœ¬åœ°æ¸¬è©¦ç”¨
        
        // è¼‰å…¥ç’°å¢ƒè³‡è¨Š
        async function loadEnvInfo() {
            try {
                const response = await fetch(`${API_BASE}/api/payment/env`);
                const result = await response.json();
                
                if (result.success) {
                    const data = result.data;
                    document.getElementById('envInfo').innerHTML = `
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div>ç’°å¢ƒï¼š</div>
                            <div class="${data.isProduction ? 'text-red-400' : 'text-green-400'}">
                                ${data.isProduction ? 'ğŸ”´ æ­£å¼ç’°å¢ƒ' : 'ğŸŸ¢ æ²™ç®±ç’°å¢ƒ'}
                            </div>
                            <div>å•†åº—IDï¼š</div>
                            <div class="text-blue-400">${data.merchantId}</div>
                            <div>APIç¶²å€ï¼š</div>
                            <div class="text-gray-300 text-xs break-all">${data.apiUrl}</div>
                            <div>å›èª¿ç¶²å€ï¼š</div>
                            <div class="text-gray-300 text-xs break-all">${data.notifyUrl}</div>
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('envInfo').innerHTML = `
                    <div class="text-red-400">âŒ ç„¡æ³•é€£æ¥å¾Œç«¯</div>
                    <div class="text-xs text-gray-500 mt-1">${error.message}</div>
                `;
            }
        }
        
        // æ¸¬è©¦è¨‚é–±ä»˜æ¬¾
        async function testSubscribe() {
            const plan = document.getElementById('plan').value;
            const billingCycle = document.getElementById('cycle').value;
            const promoCode = document.getElementById('promoCode').value || null;
            
            try {
                const response = await fetch(`${API_BASE}/api/payment/subscribe`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: 'test_user_' + Date.now(),
                        plan,
                        billingCycle,
                        promoCode
                    })
                });
                
                const result = await response.json();
                showResult(result);
                
                if (result.success) {
                    setupPaymentForm(result.paymentUrl, result.params);
                }
            } catch (error) {
                showResult({ error: error.message });
            }
        }
        
        // æ¸¬è©¦è­‰ç…§è³¼è²·
        async function testCert() {
            const certId = document.getElementById('certId').value;
            const isPro = document.getElementById('certPro').value === 'true';
            
            try {
                const response = await fetch(`${API_BASE}/api/payment/cert`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: 'test_user_' + Date.now(),
                        certId,
                        isPro
                    })
                });
                
                const result = await response.json();
                showResult(result);
                
                if (result.success) {
                    setupPaymentForm(result.paymentUrl, result.params);
                }
            } catch (error) {
                showResult({ error: error.message });
            }
        }
        
        // é¡¯ç¤ºçµæœ
        function showResult(data) {
            document.getElementById('result').textContent = JSON.stringify(data, null, 2);
        }
        
        // è¨­å®šä»˜æ¬¾è¡¨å–®
        function setupPaymentForm(url, params) {
            const form = document.getElementById('ecpayForm');
            form.action = url;
            
            // æ¸…é™¤èˆŠçš„ hidden inputs
            form.querySelectorAll('input[type="hidden"]').forEach(el => el.remove());
            
            // æ–°å¢ hidden inputs
            for (const [key, value] of Object.entries(params)) {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = key;
                input.value = value;
                form.appendChild(input);
            }
            
            document.getElementById('paymentForm').classList.remove('hidden');
        }
        
        // é é¢è¼‰å…¥
        document.addEventListener('DOMContentLoaded', loadEnvInfo);
    </script>
</body>
</html>
