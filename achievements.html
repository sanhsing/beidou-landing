<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ—æ–—æ•™è‚² | æˆå°±ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 50%, #0f172a 100%); }
        .card { background: rgba(30, 41, 59, 0.8); border: 1px solid rgba(255,255,255,0.1); }
        .achievement-card { transition: all 0.3s; }
        .achievement-card:hover { transform: translateY(-3px); }
        .achievement-card.locked { opacity: 0.5; filter: grayscale(1); }
        .achievement-card.unlocked { border-color: #f59e0b; }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">

    <!-- å°èˆªåˆ— -->
    <nav class="py-4 px-6 border-b border-white/10">
        <div class="container mx-auto flex justify-between items-center">
            <a href="index.html" class="flex items-center gap-2">
                <span class="text-2xl">ğŸŒŸ</span>
                <span class="font-bold text-xl">åŒ—æ–—æ•™è‚²</span>
            </a>
            <div class="hidden md:flex items-center gap-6">
                <a href="courses.html" class="text-gray-300 hover:text-white">å­¸æ¸¬èª²ç¨‹</a>
                <a href="dashboard.html" class="text-gray-300 hover:text-white">å„€è¡¨æ¿</a>
                <a href="battle.html" class="text-orange-400 hover:text-orange-300">âš”ï¸ æˆ°é¬¥</a>
            </div>
            <a href="auth.html" id="authLink" class="text-gray-300 hover:text-white">ç™»å…¥</a>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-8 max-w-5xl">
        <!-- æ¨™é¡Œ -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold mb-2">ğŸ† æˆå°±ç³»çµ±</h1>
            <p class="text-gray-400">å®ŒæˆæŒ‘æˆ°ï¼Œè§£é–æ¦®è€€ï¼</p>
        </div>

        <!-- é€²åº¦ç¸½è¦½ -->
        <div class="card rounded-xl p-6 mb-8">
            <div class="flex justify-between items-center mb-4">
                <span class="text-gray-400">æˆå°±é€²åº¦</span>
                <span class="text-xl font-bold">
                    <span id="unlockedCount" class="text-yellow-400">0</span>
                    <span class="text-gray-500">/</span>
                    <span id="totalCount" class="text-gray-400">0</span>
                </span>
            </div>
            <div class="h-3 bg-gray-700 rounded-full overflow-hidden">
                <div id="progressBar" class="h-full bg-gradient-to-r from-yellow-500 to-orange-500 rounded-full transition-all" style="width: 0%"></div>
            </div>
        </div>

        <!-- æˆå°±åˆ†é¡ -->
        <div class="space-y-8">
            <!-- æˆ°é¬¥æˆå°± -->
            <section>
                <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                    <span>âš”ï¸</span> æˆ°é¬¥æˆå°±
                </h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="battleAchievements"></div>
            </section>

            <!-- è²¡å¯Œæˆå°± -->
            <section>
                <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                    <span>ğŸ’°</span> è²¡å¯Œæˆå°±
                </h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="wealthAchievements"></div>
            </section>

            <!-- å­¸ç¿’æˆå°± -->
            <section>
                <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                    <span>ğŸ“š</span> å­¸ç¿’æˆå°±
                </h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="learningAchievements"></div>
            </section>

            <!-- ç‰¹æ®Šæˆå°± -->
            <section>
                <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                    <span>âœ¨</span> ç‰¹æ®Šæˆå°±
                </h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="specialAchievements"></div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="py-8 border-t border-white/10 mt-8">
        <div class="container mx-auto px-4 text-center text-gray-500">
            <p>Â© 2025 åŒ—æ–—ä¸ƒæ˜Ÿæ–‡å‰µæ•¸ä½æœ‰é™å…¬å¸</p>
        </div>
    </footer>

    <script>
        // æˆå°±å®šç¾©
        const achievementDefs = {
            battle: [
                { id: 'first_win', name: 'åˆæˆ°å‘Šæ·', emoji: 'ğŸ‰', desc: 'è´å¾—ç¬¬ä¸€å ´æˆ°é¬¥', condition: 'wins >= 1' },
                { id: 'wins_10', name: 'å°è©¦èº«æ‰‹', emoji: 'âš”ï¸', desc: 'ç´¯è¨ˆå‹åˆ© 10 å ´', condition: 'wins >= 10' },
                { id: 'wins_50', name: 'èº«ç¶“ç™¾æˆ°', emoji: 'ğŸ—¡ï¸', desc: 'ç´¯è¨ˆå‹åˆ© 50 å ´', condition: 'wins >= 50' },
                { id: 'wins_100', name: 'ç™¾æˆ°ç™¾å‹', emoji: 'ğŸ†', desc: 'ç´¯è¨ˆå‹åˆ© 100 å ´', condition: 'wins >= 100' },
                { id: 'wins_500', name: 'æˆ°ç¥é™è‡¨', emoji: 'ğŸ‘‘', desc: 'ç´¯è¨ˆå‹åˆ© 500 å ´', condition: 'wins >= 500' },
                { id: 'battles_100', name: 'å‹¤å¥®å­¸ç¿’', emoji: 'ğŸ”¥', desc: 'ç´¯è¨ˆæˆ°é¬¥ 100 å ´', condition: 'battles >= 100' },
                { id: 'battles_500', name: 'æ°¸ä¸æ”¾æ£„', emoji: 'ğŸ’ª', desc: 'ç´¯è¨ˆæˆ°é¬¥ 500 å ´', condition: 'battles >= 500' },
                { id: 'battles_1000', name: 'é‹¼éµæ„å¿—', emoji: 'ğŸ¦¾', desc: 'ç´¯è¨ˆæˆ°é¬¥ 1000 å ´', condition: 'battles >= 1000' }
            ],
            wealth: [
                { id: 'coins_100', name: 'å°æœ‰ç©è“„', emoji: 'ğŸª™', desc: 'ç´¯è¨ˆç²å¾— 100 é‡‘å¹£', condition: 'coins >= 100' },
                { id: 'coins_500', name: 'å°å¯Œç¿', emoji: 'ğŸ’°', desc: 'ç´¯è¨ˆç²å¾— 500 é‡‘å¹£', condition: 'coins >= 500' },
                { id: 'coins_2000', name: 'è²¡æºæ»¾æ»¾', emoji: 'ğŸ’', desc: 'ç´¯è¨ˆç²å¾— 2000 é‡‘å¹£', condition: 'coins >= 2000' },
                { id: 'coins_10000', name: 'å¯Œå¯æ•µåœ‹', emoji: 'ğŸ¦', desc: 'ç´¯è¨ˆç²å¾— 10000 é‡‘å¹£', condition: 'coins >= 10000' }
            ],
            learning: [
                { id: 'exp_100', name: 'å­¸ç¿’æ–°æ‰‹', emoji: 'ğŸ“–', desc: 'ç´¯è¨ˆç²å¾— 100 ç¶“é©—', condition: 'exp >= 100' },
                { id: 'exp_1000', name: 'æ±‚çŸ¥è‹¥æ¸´', emoji: 'ğŸ“š', desc: 'ç´¯è¨ˆç²å¾— 1000 ç¶“é©—', condition: 'exp >= 1000' },
                { id: 'exp_5000', name: 'å­¸å¯Œäº”è»Š', emoji: 'ğŸ“', desc: 'ç´¯è¨ˆç²å¾— 5000 ç¶“é©—', condition: 'exp >= 5000' },
                { id: 'exp_20000', name: 'å­¸è¡“å¤§å¸«', emoji: 'ğŸ§ ', desc: 'ç´¯è¨ˆç²å¾— 20000 ç¶“é©—', condition: 'exp >= 20000' }
            ],
            special: [
                { id: 'first_login', name: 'åˆä¾†ä¹åˆ°', emoji: 'ğŸ‘‹', desc: 'é¦–æ¬¡ç™»å…¥ç³»çµ±', condition: 'always' },
                { id: 'night_owl', name: 'å¤œè²“å­', emoji: 'ğŸ¦‰', desc: 'åœ¨å‡Œæ™¨ 2-4 é»æˆ°é¬¥', condition: 'special' },
                { id: 'perfect_10', name: 'å®Œç¾åé€£', emoji: 'â­', desc: 'é€£çºŒç­”å° 10 é¡Œ', condition: 'special' },
                { id: 'all_subjects', name: 'å…¨ç§‘æŒ‘æˆ°', emoji: 'ğŸŒˆ', desc: 'åœ¨æ‰€æœ‰ç§‘ç›®éƒ½ç²å¾—å‹åˆ©', condition: 'special' }
            ]
        };

        // ç²å–çµ±è¨ˆæ•¸æ“š
        function getStats() {
            const stats = JSON.parse(localStorage.getItem('beidou_battle_stats') || '{}');
            return {
                wins: stats.wins || 0,
                battles: stats.totalBattles || 0,
                coins: stats.coins || 0,
                exp: stats.exp || 0
            };
        }

        // ç²å–å·²è§£é–æˆå°±
        function getUnlocked() {
            return JSON.parse(localStorage.getItem('beidou_achievements') || '[]');
        }

        // æª¢æŸ¥æˆå°±æ˜¯å¦è§£é–
        function isUnlocked(achievementId) {
            const unlocked = getUnlocked();
            return unlocked.some(a => a.id === achievementId);
        }

        // è¨ˆç®—é€²åº¦
        function getProgress(condition, stats) {
            if (condition === 'always') return 100;
            if (condition === 'special') return 0;
            
            const match = condition.match(/(\w+)\s*>=\s*(\d+)/);
            if (match) {
                const [, field, target] = match;
                const current = stats[field] || 0;
                return Math.min(100, Math.round((current / parseInt(target)) * 100));
            }
            return 0;
        }

        // æ¸²æŸ“æˆå°±å¡ç‰‡
        function renderAchievements() {
            const stats = getStats();
            const unlocked = getUnlocked();
            let totalUnlocked = 0;
            let totalAchievements = 0;

            for (const [category, achievements] of Object.entries(achievementDefs)) {
                const container = document.getElementById(`${category}Achievements`);
                
                container.innerHTML = achievements.map(a => {
                    totalAchievements++;
                    const isAchieved = isUnlocked(a.id);
                    if (isAchieved) totalUnlocked++;
                    
                    const progress = isAchieved ? 100 : getProgress(a.condition, stats);
                    const unlockedData = isAchieved ? unlocked.find(u => u.id === a.id) : null;
                    
                    return `
                        <div class="card achievement-card rounded-xl p-4 ${isAchieved ? 'unlocked border-2' : 'locked'}">
                            <div class="text-4xl mb-2 text-center">${a.emoji}</div>
                            <h3 class="font-bold text-center mb-1">${a.name}</h3>
                            <p class="text-xs text-gray-400 text-center mb-3">${a.desc}</p>
                            ${isAchieved ? `
                                <div class="text-center text-yellow-400 text-xs">
                                    âœ“ å·²è§£é–
                                </div>
                            ` : `
                                <div class="h-1.5 bg-gray-700 rounded-full overflow-hidden">
                                    <div class="h-full bg-purple-500 rounded-full" style="width: ${progress}%"></div>
                                </div>
                                <div class="text-center text-gray-500 text-xs mt-1">${progress}%</div>
                            `}
                        </div>
                    `;
                }).join('');
            }

            // æ›´æ–°ç¸½é€²åº¦
            document.getElementById('unlockedCount').textContent = totalUnlocked;
            document.getElementById('totalCount').textContent = totalAchievements;
            document.getElementById('progressBar').style.width = `${(totalUnlocked / totalAchievements) * 100}%`;
        }

        // åˆå§‹åŒ–
        function init() {
            renderAchievements();
            
            // è‡ªå‹•è§£é–ã€Œåˆä¾†ä¹åˆ°ã€
            const unlocked = getUnlocked();
            if (!unlocked.some(a => a.id === 'first_login')) {
                unlocked.push({
                    id: 'first_login',
                    name: 'åˆä¾†ä¹åˆ°',
                    emoji: 'ğŸ‘‹',
                    desc: 'é¦–æ¬¡ç™»å…¥ç³»çµ±',
                    unlockedAt: new Date().toISOString()
                });
                localStorage.setItem('beidou_achievements', JSON.stringify(unlocked));
                renderAchievements();
            }
            
            // ç™»å…¥ç‹€æ…‹
            const user = JSON.parse(localStorage.getItem('beidou_user') || 'null');
            if (user && !user.guest) {
                document.getElementById('authLink').textContent = user.username || 'æœƒå“¡';
                document.getElementById('authLink').href = 'dashboard.html';
            }
        }

        init();
    </script>
</body>
</html>
