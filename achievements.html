<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ—æ–—æ•™è‚² | æˆå°±å¾½ç« </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%); }
        .card { background: rgba(255,255,255,0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .badge { transition: all 0.3s; }
        .badge:hover { transform: scale(1.05); }
        .badge.locked { filter: grayscale(1) opacity(0.5); }
        .badge.unlocked { animation: unlock 0.5s ease-out; }
        @keyframes unlock { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <nav class="border-b border-white/10 px-6 py-4">
        <div class="max-w-4xl mx-auto flex items-center justify-between">
            <a href="index.html" class="flex items-center gap-2">
                <span class="text-2xl">ğŸŒŸ</span>
                <span class="font-bold text-xl">åŒ—æ–—æ•™è‚²</span>
            </a>
            <a href="dashboard.html" class="text-gray-400 hover:text-white">â† è¿”å›å„€è¡¨æ¿</a>
        </div>
    </nav>

    <main class="max-w-4xl mx-auto px-6 py-8">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold mb-2">ğŸ† æˆå°±å¾½ç« </h1>
            <p class="text-gray-400">å·²è§£é– <span id="unlockedCount" class="text-purple-400 font-bold">0</span> / <span id="totalCount">0</span></p>
        </div>
        
        <!-- é€²åº¦æ¢ -->
        <div class="card rounded-xl p-4 mb-8">
            <div class="flex justify-between text-sm mb-2">
                <span>æ”¶é›†é€²åº¦</span>
                <span id="progressPercent">0%</span>
            </div>
            <div class="h-3 bg-white/10 rounded-full overflow-hidden">
                <div id="progressBar" class="h-full bg-gradient-to-r from-purple-600 to-blue-600 transition-all" style="width:0%"></div>
            </div>
        </div>

        <!-- åˆ†é¡ï¼šç­”é¡Œ -->
        <section class="mb-8">
            <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">ğŸ“ ç­”é¡Œæˆå°±</h2>
            <div id="answerBadges" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
        </section>

        <!-- åˆ†é¡ï¼šé€£çºŒ -->
        <section class="mb-8">
            <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">ğŸ”¥ é€£çºŒå­¸ç¿’</h2>
            <div id="streakBadges" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
        </section>

        <!-- åˆ†é¡ï¼šç­‰ç´š -->
        <section class="mb-8">
            <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">â­ ç­‰ç´šæˆå°±</h2>
            <div id="levelBadges" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
        </section>

        <!-- åˆ†é¡ï¼šç‰¹æ®Š -->
        <section class="mb-8">
            <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">âœ¨ ç‰¹æ®Šæˆå°±</h2>
            <div id="specialBadges" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
        </section>
    </main>

    <!-- è©³æƒ… Modal -->
    <div id="modal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
        <div class="card rounded-2xl max-w-sm w-full p-6 text-center">
            <div id="modalIcon" class="text-6xl mb-4"></div>
            <h3 id="modalName" class="text-xl font-bold mb-2"></h3>
            <p id="modalDesc" class="text-gray-400 mb-4"></p>
            <div id="modalReward" class="text-sm text-purple-400 mb-4"></div>
            <div id="modalStatus" class="mb-4"></div>
            <button onclick="closeModal()" class="w-full bg-purple-600 hover:bg-purple-700 py-3 rounded-lg">é—œé–‰</button>
        </div>
    </div>

    <script>
        const API_BASE = 'https://beidou-edu-server-1.onrender.com/api';
        let achievements = [];

        document.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('beidou_token');
            if (!token) { window.location.href = 'auth.html'; return; }
            loadAchievements();
        });

        async function loadAchievements() {
            const token = localStorage.getItem('beidou_token');
            try {
                const res = await fetch(`${API_BASE}/achievements/mine`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();
                if (data.success) {
                    achievements = data.data.achievements;
                    render(data.data.unlocked, data.data.total);
                }
            } catch (e) { useMock(); }
        }

        function useMock() {
            achievements = [
                { id: 'first_answer', name: 'åˆè©¦å•¼è²', description: 'å®Œæˆç¬¬ä¸€é“é¡Œç›®', icon: 'ğŸ¯', xp: 10, coins: 20, unlocked: true, condition: { type: 'total_answers' } },
                { id: 'answer_10', name: 'åé¡Œé”äºº', description: 'ç´¯è¨ˆç­”é¡Œ 10 é“', icon: 'ğŸ“', xp: 50, coins: 30, unlocked: true, condition: { type: 'total_answers' } },
                { id: 'answer_100', name: 'ç™¾é¡Œæˆ°å£«', description: 'ç´¯è¨ˆç­”é¡Œ 100 é“', icon: 'âš”ï¸', xp: 200, coins: 100, unlocked: false, condition: { type: 'total_answers' } },
                { id: 'answer_1000', name: 'åƒé¡Œå®—å¸«', description: 'ç´¯è¨ˆç­”é¡Œ 1000 é“', icon: 'ğŸ†', xp: 1000, coins: 500, unlocked: false, condition: { type: 'total_answers' } },
                { id: 'streak_3', name: 'ä¸‰æ—¥ä¸è¼Ÿ', description: 'é€£çºŒå­¸ç¿’ 3 å¤©', icon: 'ğŸ”¥', xp: 50, coins: 30, unlocked: true, condition: { type: 'streak_days' } },
                { id: 'streak_7', name: 'é€±é€±å‘ä¸Š', description: 'é€£çºŒå­¸ç¿’ 7 å¤©', icon: 'ğŸŒŸ', xp: 150, coins: 100, unlocked: false, condition: { type: 'streak_days' } },
                { id: 'streak_30', name: 'æœˆåº¦å …æŒ', description: 'é€£çºŒå­¸ç¿’ 30 å¤©', icon: 'ğŸ’', xp: 500, coins: 300, unlocked: false, condition: { type: 'streak_days' } },
                { id: 'level_5', name: 'åˆéœ²é‹’èŠ’', description: 'é”åˆ°ç­‰ç´š 5', icon: 'â­', xp: 0, coins: 50, unlocked: true, condition: { type: 'level' } },
                { id: 'level_10', name: 'æ¼¸å…¥ä½³å¢ƒ', description: 'é”åˆ°ç­‰ç´š 10', icon: 'ğŸŒŸ', xp: 0, coins: 100, unlocked: false, condition: { type: 'level' } },
                { id: 'level_20', name: 'çˆç«ç´”é’', description: 'é”åˆ°ç­‰ç´š 20', icon: 'ğŸ’«', xp: 0, coins: 200, unlocked: false, condition: { type: 'level' } },
                { id: 'perfect_10', name: 'å®Œç¾åé€£', description: 'é€£çºŒç­”å° 10 é¡Œ', icon: 'âœ¨', xp: 100, coins: 50, unlocked: false, condition: { type: 'streak_correct' } },
                { id: 'accuracy_90', name: 'ç²¾æº–å°„æ‰‹', description: 'ç¸½æ­£ç¢ºç‡é”åˆ° 90%', icon: 'ğŸ¯', xp: 300, coins: 150, unlocked: false, condition: { type: 'accuracy' } },
                { id: 'all_subjects', name: 'å…¨ç§‘é”äºº', description: 'åœ¨æ‰€æœ‰ 10 å€‹ç§‘ç›®éƒ½ç­”éé¡Œ', icon: 'ğŸŒˆ', xp: 200, coins: 100, unlocked: false, condition: { type: 'subjects_covered' } },
                { id: 'first_referral', name: 'å¥½å‹åŒè¡Œ', description: 'æˆåŠŸæ¨è–¦ 1 ä½å¥½å‹', icon: 'ğŸ¤', xp: 100, coins: 100, unlocked: false, condition: { type: 'referrals' } },
                { id: 'referral_5', name: 'äººæ°£ç‹', description: 'æˆåŠŸæ¨è–¦ 5 ä½å¥½å‹', icon: 'ğŸ‘‘', xp: 500, coins: 500, unlocked: false, condition: { type: 'referrals' } }
            ];
            render(achievements.filter(a => a.unlocked).length, achievements.length);
        }

        function render(unlocked, total) {
            document.getElementById('unlockedCount').textContent = unlocked;
            document.getElementById('totalCount').textContent = total;
            const pct = Math.round((unlocked / total) * 100);
            document.getElementById('progressPercent').textContent = `${pct}%`;
            document.getElementById('progressBar').style.width = `${pct}%`;

            const answer = achievements.filter(a => a.condition?.type === 'total_answers' || a.id.startsWith('answer') || a.id === 'first_answer');
            const streak = achievements.filter(a => a.condition?.type === 'streak_days' || a.condition?.type === 'streak_correct' || a.id.startsWith('streak') || a.id === 'perfect_10');
            const level = achievements.filter(a => a.condition?.type === 'level' || a.id.startsWith('level'));
            const special = achievements.filter(a => !answer.includes(a) && !streak.includes(a) && !level.includes(a));

            document.getElementById('answerBadges').innerHTML = answer.map(badgeHTML).join('');
            document.getElementById('streakBadges').innerHTML = streak.map(badgeHTML).join('');
            document.getElementById('levelBadges').innerHTML = level.map(badgeHTML).join('');
            document.getElementById('specialBadges').innerHTML = special.map(badgeHTML).join('');
        }

        function badgeHTML(a) {
            return `
                <div class="badge card rounded-xl p-4 text-center cursor-pointer ${a.unlocked ? 'unlocked' : 'locked'}" onclick='showDetail(${JSON.stringify(a).replace(/'/g, "\\'")})'>
                    <div class="text-4xl mb-2">${a.icon}</div>
                    <div class="font-medium text-sm">${a.name}</div>
                    ${a.unlocked ? '<div class="text-green-400 text-xs mt-1">âœ“ å·²è§£é–</div>' : '<div class="text-gray-500 text-xs mt-1">ğŸ”’ æœªè§£é–</div>'}
                </div>
            `;
        }

        function showDetail(a) {
            document.getElementById('modalIcon').textContent = a.icon;
            document.getElementById('modalName').textContent = a.name;
            document.getElementById('modalDesc').textContent = a.description;
            document.getElementById('modalReward').textContent = `çå‹µï¼š+${a.xp} XP / +${a.coins} é‡‘å¹£`;
            document.getElementById('modalStatus').innerHTML = a.unlocked 
                ? '<span class="text-green-400">âœ“ å·²è§£é–</span>' 
                : '<span class="text-gray-500">ğŸ”’ å°šæœªé”æˆ</span>';
            document.getElementById('modal').classList.remove('hidden');
        }

        function closeModal() { document.getElementById('modal').classList.add('hidden'); }
        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });
    </script>
</body>
</html>
