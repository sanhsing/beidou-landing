<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ—æ–—æ•™è‚² | éŒ¯é¡Œæœ¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 50%, #0f172a 100%); }
        .card { background: rgba(30, 41, 59, 0.8); border: 1px solid rgba(255,255,255,0.1); }
        .tab-btn.active { border-color: #3b82f6; background: rgba(59,130,246,0.2); }
        .misconception-card { transition: all 0.3s; }
        .misconception-card:hover { transform: translateX(4px); }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">

    <nav class="py-4 px-6 border-b border-white/10">
        <div class="container mx-auto flex justify-between items-center">
            <a href="index.html" class="flex items-center gap-2">
                <span class="text-2xl">ğŸŒŸ</span>
                <span class="font-bold text-xl">åŒ—æ–—æ•™è‚²</span>
            </a>
            <a href="dashboard.html" class="text-gray-300 hover:text-white">â† è¿”å›</a>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-8 max-w-4xl">
        <h1 class="text-3xl font-bold text-center mb-2">ğŸ“• éŒ¯é¡Œæœ¬</h1>
        <p class="text-center text-gray-400 mb-8">å¾éŒ¯èª¤ä¸­å­¸ç¿’ï¼Œé¿å…é‡è¹ˆè¦†è½</p>

        <!-- æ¨™ç±¤åˆ‡æ› -->
        <div class="flex justify-center gap-4 mb-8">
            <button onclick="switchTab('wrong')" id="tabWrong" class="tab-btn px-6 py-2 rounded-full border border-white/20 hover:border-blue-400 transition active">
                ğŸ“ æˆ‘çš„éŒ¯é¡Œ
            </button>
            <button onclick="switchTab('misconception')" id="tabMisconception" class="tab-btn px-6 py-2 rounded-full border border-white/20 hover:border-blue-400 transition">
                âš ï¸ å¸¸è¦‹è¿·æ€
            </button>
        </div>

        <!-- æˆ‘çš„éŒ¯é¡Œ -->
        <div id="wrongPanel">
            <div id="wrongList" class="space-y-4">
                <!-- å‹•æ…‹ç”Ÿæˆ -->
            </div>
            <div id="emptyWrong" class="card rounded-xl p-12 text-center hidden">
                <div class="text-6xl mb-4">ğŸ‰</div>
                <div class="text-xl font-bold mb-2">å¤ªæ£’äº†ï¼</div>
                <div class="text-gray-400">ç›®å‰æ²’æœ‰éŒ¯é¡Œè¨˜éŒ„</div>
                <a href="learn.html" class="inline-block mt-4 px-6 py-2 bg-blue-600 hover:bg-blue-500 rounded-lg transition">
                    å»ç·´ç¿’
                </a>
            </div>
        </div>

        <!-- å¸¸è¦‹è¿·æ€ -->
        <div id="misconceptionPanel" class="hidden">
            <!-- é ˜åŸŸç¯©é¸ -->
            <div id="domainTabs" class="flex flex-wrap justify-center gap-2 mb-6">
                <!-- å‹•æ…‹ç”Ÿæˆ -->
            </div>

            <div id="misconceptionList" class="space-y-4">
                <!-- å‹•æ…‹ç”Ÿæˆ -->
            </div>
        </div>
    </main>

    <script>
        let wrongQuestions = [];
        let misconceptions = [];
        let currentDomain = 'all';

        async function loadData() {
            // è¼‰å…¥éŒ¯é¡Œ (localStorage)
            try {
                wrongQuestions = JSON.parse(localStorage.getItem('beidou_wrong_questions') || '[]');
            } catch { wrongQuestions = []; }

            // è¼‰å…¥è¿·æ€åº«
            try {
                const res = await fetch('data/misconceptions.json');
                const data = await res.json();
                misconceptions = data.items;
            } catch (e) {
                console.error('è¼‰å…¥è¿·æ€åº«å¤±æ•—:', e);
            }

            renderWrong();
            renderDomainTabs();
            renderMisconceptions();
        }

        function switchTab(tab) {
            document.getElementById('tabWrong').classList.toggle('active', tab === 'wrong');
            document.getElementById('tabMisconception').classList.toggle('active', tab === 'misconception');
            document.getElementById('wrongPanel').classList.toggle('hidden', tab !== 'wrong');
            document.getElementById('misconceptionPanel').classList.toggle('hidden', tab !== 'misconception');
        }

        function renderWrong() {
            const list = document.getElementById('wrongList');
            const empty = document.getElementById('emptyWrong');

            if (wrongQuestions.length === 0) {
                list.classList.add('hidden');
                empty.classList.remove('hidden');
                return;
            }

            list.classList.remove('hidden');
            empty.classList.add('hidden');

            list.innerHTML = wrongQuestions.map((q, i) => `
                <div class="card rounded-xl p-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm text-gray-400">${q.subject || 'æœªåˆ†é¡'}</span>
                        <span class="text-xs text-gray-500">${q.date || ''}</span>
                    </div>
                    <div class="mb-2">${q.question}</div>
                    <div class="flex items-center gap-4 text-sm">
                        <span class="text-red-400">ä½ çš„ç­”æ¡ˆ: ${q.userAnswer}</span>
                        <span class="text-green-400">æ­£ç¢ºç­”æ¡ˆ: ${q.correctAnswer}</span>
                    </div>
                    <button onclick="removeWrong(${i})" class="mt-2 text-xs text-gray-500 hover:text-red-400">
                        ğŸ—‘ï¸ ç§»é™¤
                    </button>
                </div>
            `).join('');
        }

        function removeWrong(idx) {
            wrongQuestions.splice(idx, 1);
            localStorage.setItem('beidou_wrong_questions', JSON.stringify(wrongQuestions));
            renderWrong();
        }

        function renderDomainTabs() {
            const domains = [...new Set(misconceptions.map(m => m.domain))];
            const tabs = document.getElementById('domainTabs');
            tabs.innerHTML = `
                <button onclick="filterDomain('all')" class="tab-btn px-4 py-1 rounded-full border border-white/20 text-sm ${currentDomain === 'all' ? 'active' : ''}">
                    å…¨éƒ¨
                </button>
            ` + domains.map(d => `
                <button onclick="filterDomain('${d}')" class="tab-btn px-4 py-1 rounded-full border border-white/20 text-sm ${currentDomain === d ? 'active' : ''}">
                    ${d}
                </button>
            `).join('');
        }

        function filterDomain(domain) {
            currentDomain = domain;
            renderDomainTabs();
            renderMisconceptions();
        }

        function renderMisconceptions() {
            const list = document.getElementById('misconceptionList');
            const filtered = currentDomain === 'all' 
                ? misconceptions 
                : misconceptions.filter(m => m.domain === currentDomain);

            list.innerHTML = filtered.map(m => `
                <div class="misconception-card card rounded-xl p-5">
                    <div class="flex items-start gap-4">
                        <div class="text-3xl">âŒ</div>
                        <div class="flex-1">
                            <div class="text-sm text-gray-500 mb-1">${m.domain}</div>
                            <div class="font-bold text-red-400 mb-2">è¿·æ€ï¼š${m.misconception}</div>
                            <div class="text-gray-400 text-sm mb-2">
                                <span class="text-gray-500">éŒ¯èª¤æƒ³æ³•ï¼š</span>${m.wrong_thinking}
                            </div>
                            <div class="bg-green-900/20 border border-green-500/20 rounded-lg p-3">
                                <div class="text-green-400 font-bold mb-1">âœ“ æ­£ç¢ºè§€å¿µ</div>
                                <div class="text-gray-300 text-sm">${m.truth}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        loadData();
    </script>
</body>
</html>
