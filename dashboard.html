<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ—æ–—æ•™è‚² | å€‹äººå„€è¡¨æ¿</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 50%, #0f172a 100%); }
        .card { background: rgba(30, 41, 59, 0.8); border: 1px solid rgba(255,255,255,0.1); }
        .stat-card { transition: all 0.3s; }
        .stat-card:hover { transform: translateY(-3px); }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">

    <!-- å°èˆªåˆ— -->
    <nav class="py-4 px-6 border-b border-white/10">
        <div class="container mx-auto flex justify-between items-center">
            <a href="index.html" class="flex items-center gap-2">
                <span class="text-2xl">ğŸŒŸ</span>
                <span class="font-bold text-xl">åŒ—æ–—æ•™è‚²</span>
            </a>
            <div class="hidden md:flex items-center gap-6">
                <a href="courses.html" class="text-gray-300 hover:text-white">å­¸æ¸¬èª²ç¨‹</a>
                <a href="ai_courses.html" class="text-gray-300 hover:text-white">AIèªè­‰</a>
                <a href="starmap.html" class="text-gray-300 hover:text-white">çŸ¥è­˜æ˜Ÿåœ–</a>
                <a href="battle.html" class="text-orange-400 hover:text-orange-300">âš”ï¸ æˆ°é¬¥</a>
            </div>
            <button onclick="logout()" class="text-gray-300 hover:text-white">ç™»å‡º</button>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- æ­¡è¿å€ -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold mb-2">
                <span id="greeting">ä½ å¥½</span>ï¼Œ<span id="userName">å†’éšªè€…</span>ï¼
            </h1>
            <p class="text-gray-400">ç¹¼çºŒä½ çš„å­¸æ¸¬å¾é€” âš”ï¸</p>
        </div>

        <!-- çµ±è¨ˆå¡ç‰‡ -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div class="card rounded-xl p-5 stat-card">
                <div class="text-3xl mb-2">âš”ï¸</div>
                <div class="text-3xl font-bold text-blue-400" id="totalBattles">0</div>
                <div class="text-gray-400 text-sm">ç¸½æˆ°é¬¥æ¬¡æ•¸</div>
            </div>
            <div class="card rounded-xl p-5 stat-card">
                <div class="text-3xl mb-2">ğŸ†</div>
                <div class="text-3xl font-bold text-green-400" id="totalWins">0</div>
                <div class="text-gray-400 text-sm">å‹åˆ©æ¬¡æ•¸</div>
            </div>
            <div class="card rounded-xl p-5 stat-card">
                <div class="text-3xl mb-2">ğŸ’°</div>
                <div class="text-3xl font-bold text-yellow-400" id="totalCoins">0</div>
                <div class="text-gray-400 text-sm">ç´¯ç©é‡‘å¹£</div>
            </div>
            <div class="card rounded-xl p-5 stat-card">
                <div class="text-3xl mb-2">âš¡</div>
                <div class="text-3xl font-bold text-purple-400" id="totalExp">0</div>
                <div class="text-gray-400 text-sm">ç´¯ç©ç¶“é©—</div>
            </div>
        </div>

        <div class="grid md:grid-cols-3 gap-6">
            <!-- å·¦å´ï¼šå‹ç‡èˆ‡ç­‰ç´š -->
            <div class="md:col-span-2 space-y-6">
                <!-- å‹ç‡ -->
                <div class="card rounded-xl p-6">
                    <h2 class="text-xl font-bold mb-4">ğŸ“Š æˆ°é¬¥çµ±è¨ˆ</h2>
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <div class="text-gray-400 mb-2">å‹ç‡</div>
                            <div class="text-4xl font-bold text-green-400" id="winRate">0%</div>
                            <div class="h-2 bg-gray-700 rounded-full mt-2 overflow-hidden">
                                <div id="winRateBar" class="h-full bg-green-500 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="text-gray-400 mb-2">ç•¶å‰ç­‰ç´š</div>
                            <div class="text-4xl font-bold text-purple-400">Lv.<span id="playerLevel">1</span></div>
                            <div class="text-sm text-gray-500 mt-2">
                                ç¶“é©—ï¼š<span id="expProgress">0</span> / <span id="expNeeded">100</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ç§‘ç›®æˆ°ç¸¾ -->
                <div class="card rounded-xl p-6">
                    <h2 class="text-xl font-bold mb-4">ğŸ“š ç§‘ç›®æˆ°ç¸¾</h2>
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-3" id="subjectStats">
                        <!-- å‹•æ…‹è¼‰å…¥ -->
                    </div>
                </div>

                <!-- æœ€è¿‘æˆ°é¬¥ -->
                <div class="card rounded-xl p-6">
                    <h2 class="text-xl font-bold mb-4">âš”ï¸ æœ€è¿‘æˆ°é¬¥</h2>
                    <div id="recentBattles" class="space-y-3">
                        <p class="text-gray-500 text-center py-4">å°šç„¡æˆ°é¬¥ç´€éŒ„</p>
                    </div>
                </div>
            </div>

            <!-- å³å´ï¼šå¿«æ·æ“ä½œ -->
            <div class="space-y-6">
                <!-- å¿«æ·æ“ä½œ -->
                <div class="card rounded-xl p-6">
                    <h2 class="text-xl font-bold mb-4">ğŸš€ å¿«æ·æ“ä½œ</h2>
                    <div class="space-y-3">
                        <a href="battle.html" class="block w-full bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-400 hover:to-red-500 py-3 rounded-lg font-bold text-center">
                            âš”ï¸ é–‹å§‹æˆ°é¬¥
                        </a>
                        <a href="wrong_book.html" class="block w-full bg-slate-700 hover:bg-slate-600 py-3 rounded-lg font-medium text-center">
                            ğŸ“– éŒ¯é¡Œæœ¬
                        </a>
                        <a href="achievements.html" class="block w-full bg-slate-700 hover:bg-slate-600 py-3 rounded-lg font-medium text-center">
                            ğŸ† æˆå°±ç³»çµ±
                        </a>
                        <a href="starmap.html" class="block w-full bg-slate-700 hover:bg-slate-600 py-3 rounded-lg font-medium text-center">
                            ğŸŒŸ çŸ¥è­˜æ˜Ÿåœ–
                        </a>
                        <a href="pricing.html" class="block w-full bg-slate-700 hover:bg-slate-600 py-3 rounded-lg font-medium text-center">
                            ğŸ’ å‡ç´šæ–¹æ¡ˆ
                        </a>
                    </div>
                </div>

                <!-- è¨‚é–±ç‹€æ…‹ -->
                <div class="card rounded-xl p-6">
                    <h2 class="text-xl font-bold mb-4">ğŸ’³ è¨‚é–±ç‹€æ…‹</h2>
                    <div id="subscriptionInfo">
                        <div class="text-center py-4">
                            <div class="text-2xl mb-2">ğŸ®</div>
                            <div class="font-bold">å…è²»ç‰ˆ</div>
                            <div class="text-gray-400 text-sm mt-1">æ¯æ—¥ 10 å ´æˆ°é¬¥</div>
                            <a href="pricing.html" class="inline-block mt-3 text-yellow-400 hover:text-yellow-300 text-sm">
                                å‡ç´šè§£é–æ›´å¤š â†’
                            </a>
                        </div>
                    </div>
                </div>

                <!-- æˆå°± -->
                <div class="card rounded-xl p-6">
                    <h2 class="text-xl font-bold mb-4">ğŸ… è¿‘æœŸæˆå°±</h2>
                    <div id="recentAchievements" class="space-y-2">
                        <p class="text-gray-500 text-center py-4">å°šç„¡æˆå°±</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="py-8 border-t border-white/10 mt-8">
        <div class="container mx-auto px-4 text-center text-gray-500">
            <p>Â© 2025 åŒ—æ–—ä¸ƒæ˜Ÿæ–‡å‰µæ•¸ä½æœ‰é™å…¬å¸</p>
        </div>
    </footer>

    <script>
        // ============================================================
        // åˆå§‹åŒ–
        // ============================================================
        function init() {
            // æª¢æŸ¥ç™»å…¥
            const user = JSON.parse(localStorage.getItem('beidou_user') || 'null');
            if (!user) {
                window.location.href = 'auth.html';
                return;
            }

            // é¡¯ç¤ºç”¨æˆ¶å
            document.getElementById('userName').textContent = user.username || 'å†’éšªè€…';
            
            // å•å€™èª
            const hour = new Date().getHours();
            let greeting = 'ä½ å¥½';
            if (hour < 12) greeting = 'æ—©å®‰';
            else if (hour < 18) greeting = 'åˆå®‰';
            else greeting = 'æ™šå®‰';
            document.getElementById('greeting').textContent = greeting;

            // è¼‰å…¥çµ±è¨ˆ
            loadStats();
            loadSubjectStats();
            loadRecentBattles();
            loadSubscription();
            loadAchievements();
        }

        // ============================================================
        // è¼‰å…¥çµ±è¨ˆ (å¾ localStorage)
        // ============================================================
        function loadStats() {
            const stats = JSON.parse(localStorage.getItem('beidou_battle_stats') || '{}');
            
            const battles = stats.totalBattles || 0;
            const wins = stats.wins || 0;
            const coins = stats.coins || 0;
            const exp = stats.exp || 0;
            
            document.getElementById('totalBattles').textContent = battles;
            document.getElementById('totalWins').textContent = wins;
            document.getElementById('totalCoins').textContent = coins;
            document.getElementById('totalExp').textContent = exp;
            
            // å‹ç‡
            const winRate = battles > 0 ? Math.round((wins / battles) * 100) : 0;
            document.getElementById('winRate').textContent = winRate + '%';
            document.getElementById('winRateBar').style.width = winRate + '%';
            
            // ç­‰ç´š
            const level = Math.floor(exp / 100) + 1;
            const expProgress = exp % 100;
            document.getElementById('playerLevel').textContent = level;
            document.getElementById('expProgress').textContent = expProgress;
            document.getElementById('expNeeded').textContent = 100;
        }

        // ============================================================
        // ç§‘ç›®çµ±è¨ˆ
        // ============================================================
        function loadSubjectStats() {
            const subjectData = JSON.parse(localStorage.getItem('beidou_subject_stats') || '{}');
            const subjects = [
                { id: 'æ•¸å­¸', emoji: 'ğŸ“', color: 'blue' },
                { id: 'ç‰©ç†', emoji: 'âš¡', color: 'yellow' },
                { id: 'åŒ–å­¸', emoji: 'ğŸ§ª', color: 'purple' },
                { id: 'ç”Ÿç‰©', emoji: 'ğŸ§¬', color: 'green' },
                { id: 'åœ‹æ–‡', emoji: 'ğŸ“š', color: 'red' }
            ];
            
            const container = document.getElementById('subjectStats');
            container.innerHTML = subjects.map(s => {
                const data = subjectData[s.id] || { wins: 0, battles: 0 };
                const rate = data.battles > 0 ? Math.round((data.wins / data.battles) * 100) : 0;
                return `
                    <div class="text-center p-3 bg-slate-700/50 rounded-lg">
                        <div class="text-2xl mb-1">${s.emoji}</div>
                        <div class="text-xs text-gray-400">${s.id}</div>
                        <div class="text-lg font-bold text-${s.color}-400">${rate}%</div>
                    </div>
                `;
            }).join('');
        }

        // ============================================================
        // æœ€è¿‘æˆ°é¬¥
        // ============================================================
        function loadRecentBattles() {
            const battles = JSON.parse(localStorage.getItem('beidou_recent_battles') || '[]');
            const container = document.getElementById('recentBattles');
            
            if (battles.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">å°šç„¡æˆ°é¬¥ç´€éŒ„<br><a href="battle.html" class="text-orange-400">é–‹å§‹ç¬¬ä¸€å ´æˆ°é¬¥ â†’</a></p>';
                return;
            }
            
            container.innerHTML = battles.slice(0, 5).map(b => `
                <div class="flex items-center justify-between p-3 bg-slate-700/50 rounded-lg">
                    <div class="flex items-center gap-3">
                        <span class="text-xl">${b.won ? 'ğŸ†' : 'ğŸ’€'}</span>
                        <div>
                            <div class="font-medium">${b.monster || 'æœªçŸ¥æ€ªç‰©'}</div>
                            <div class="text-xs text-gray-400">${b.subject || ''}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm ${b.won ? 'text-green-400' : 'text-red-400'}">${b.won ? 'å‹åˆ©' : 'æˆ°æ•—'}</div>
                        <div class="text-xs text-gray-500">${b.time || ''}</div>
                    </div>
                </div>
            `).join('');
        }

        // ============================================================
        // è¨‚é–±ç‹€æ…‹
        // ============================================================
        function loadSubscription() {
            const sub = JSON.parse(localStorage.getItem('beidou_subscription') || 'null');
            const container = document.getElementById('subscriptionInfo');
            
            if (sub && sub.plan) {
                const plans = {
                    standard: { name: 'æ¨™æº–ç‰ˆ', emoji: 'âš”ï¸', desc: 'ç„¡é™æˆ°é¬¥' },
                    premium: { name: 'é€²éšç‰ˆ', emoji: 'ğŸ‘‘', desc: 'AI åŠ©æ•™ + ç„¡é™æˆ°é¬¥' }
                };
                const p = plans[sub.plan] || plans.standard;
                container.innerHTML = `
                    <div class="text-center py-4">
                        <div class="text-2xl mb-2">${p.emoji}</div>
                        <div class="font-bold text-yellow-400">${p.name}</div>
                        <div class="text-gray-400 text-sm mt-1">${p.desc}</div>
                    </div>
                `;
            }
        }

        // ============================================================
        // æˆå°±
        // ============================================================
        function loadAchievements() {
            const achievements = JSON.parse(localStorage.getItem('beidou_achievements') || '[]');
            const container = document.getElementById('recentAchievements');
            
            if (achievements.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">å°šç„¡æˆå°±<br>ç¹¼çºŒæˆ°é¬¥è§£é–ï¼</p>';
                return;
            }
            
            container.innerHTML = achievements.slice(0, 3).map(a => `
                <div class="flex items-center gap-3 p-2 bg-slate-700/50 rounded-lg">
                    <span class="text-xl">${a.emoji || 'ğŸ…'}</span>
                    <div>
                        <div class="font-medium text-sm">${a.name}</div>
                        <div class="text-xs text-gray-400">${a.desc || ''}</div>
                    </div>
                </div>
            `).join('');
        }

        // ============================================================
        // ç™»å‡º
        // ============================================================
        function logout() {
            if (confirm('ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ')) {
                localStorage.removeItem('beidou_token');
                localStorage.removeItem('beidou_user');
                localStorage.removeItem('beidou_guest');
                window.location.href = 'index.html';
            }
        }

        // å•Ÿå‹•
        init();
    </script>
</body>
</html>
