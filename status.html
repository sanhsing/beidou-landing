<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»çµ±ç‹€æ…‹ - åŒ—æ–—æ•™è‚²</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .status-ok { color: #10b981; }
        .status-error { color: #ef4444; }
        .status-pending { color: #f59e0b; }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen p-8">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-2xl font-bold mb-8 text-center">ğŸ”§ ç³»çµ±ç‹€æ…‹æª¢æŸ¥</h1>
        
        <div class="bg-gray-800 rounded-2xl p-6 mb-6">
            <h2 class="font-bold mb-4">å¾Œç«¯ API</h2>
            <div id="apiStatus" class="space-y-3">
                <div class="text-gray-500">æª¢æŸ¥ä¸­...</div>
            </div>
        </div>

        <div class="bg-gray-800 rounded-2xl p-6 mb-6">
            <h2 class="font-bold mb-4">å‰ç«¯é é¢</h2>
            <div id="pageStatus" class="space-y-2">
                <div class="text-gray-500">æª¢æŸ¥ä¸­...</div>
            </div>
        </div>

        <div class="bg-gray-800 rounded-2xl p-6 mb-6">
            <h2 class="font-bold mb-4">PWA ç‹€æ…‹</h2>
            <div id="pwaStatus" class="space-y-2">
                <div class="text-gray-500">æª¢æŸ¥ä¸­...</div>
            </div>
        </div>

        <div class="text-center">
            <button onclick="runAllChecks()" class="bg-purple-600 hover:bg-purple-700 px-6 py-2 rounded-lg transition">
                ğŸ”„ é‡æ–°æª¢æŸ¥
            </button>
        </div>

        <div class="mt-8 text-center text-gray-500 text-sm">
            <div>ç‰ˆæœ¬: v12.12</div>
            <div id="checkTime"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://beidou-edu-server-1.onrender.com';
        
        const API_ENDPOINTS = [
            { name: 'å¥åº·æª¢æŸ¥', path: '/health' },
            { name: 'é¡Œåº«çµ±è¨ˆ', path: '/api/quiz/stats' },
            { name: 'ç§‘ç›®åˆ—è¡¨', path: '/api/quiz/subjects' },
            { name: 'æˆå°±åˆ—è¡¨', path: '/api/achievements' }
        ];

        const PAGES = [
            'index.html',
            'auth.html',
            'dashboard.html',
            'quiz_ui.html',
            'class.html',
            'courses.html',
            'course_learn.html',
            'xtf_starmap.html'
        ];

        // æª¢æŸ¥ API
        async function checkAPIs() {
            const container = document.getElementById('apiStatus');
            container.innerHTML = '';

            for (const endpoint of API_ENDPOINTS) {
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center';
                div.innerHTML = `
                    <span>${endpoint.name}</span>
                    <span class="status-pending">â³ æª¢æŸ¥ä¸­</span>
                `;
                container.appendChild(div);

                try {
                    const start = Date.now();
                    const response = await fetch(`${API_BASE}${endpoint.path}`, { 
                        method: 'GET',
                        mode: 'cors'
                    });
                    const time = Date.now() - start;
                    
                    if (response.ok) {
                        div.innerHTML = `
                            <span>${endpoint.name}</span>
                            <span class="status-ok">âœ… æ­£å¸¸ (${time}ms)</span>
                        `;
                    } else {
                        div.innerHTML = `
                            <span>${endpoint.name}</span>
                            <span class="status-error">âŒ éŒ¯èª¤ ${response.status}</span>
                        `;
                    }
                } catch (error) {
                    div.innerHTML = `
                        <span>${endpoint.name}</span>
                        <span class="status-error">âŒ ç„¡æ³•é€£ç·š</span>
                    `;
                }
            }
        }

        // æª¢æŸ¥é é¢
        function checkPages() {
            const container = document.getElementById('pageStatus');
            container.innerHTML = '';

            PAGES.forEach(page => {
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center text-sm';
                
                // ç°¡å–®æª¢æŸ¥ï¼šé é¢æ˜¯å¦å­˜åœ¨ï¼ˆå¯¦éš›éœ€è¦ fetchï¼‰
                const exists = true; // å‡è¨­éƒ½å­˜åœ¨
                
                div.innerHTML = `
                    <span>${page}</span>
                    <span class="status-ok">âœ…</span>
                `;
                container.appendChild(div);
            });

            // çµ±è¨ˆ
            const total = document.createElement('div');
            total.className = 'mt-3 pt-3 border-t border-gray-700 text-center';
            total.innerHTML = `<span class="text-purple-400">${PAGES.length} / 18 é é¢å·²æª¢æŸ¥</span>`;
            container.appendChild(total);
        }

        // æª¢æŸ¥ PWA
        function checkPWA() {
            const container = document.getElementById('pwaStatus');
            const checks = [];

            // Service Worker
            if ('serviceWorker' in navigator) {
                checks.push({ name: 'Service Worker', status: true });
            } else {
                checks.push({ name: 'Service Worker', status: false });
            }

            // HTTPS
            checks.push({ 
                name: 'HTTPS', 
                status: location.protocol === 'https:' || location.hostname === 'localhost'
            });

            // Manifest
            const manifest = document.querySelector('link[rel="manifest"]');
            checks.push({ name: 'Manifest', status: !!manifest });

            // æ¸²æŸ“
            container.innerHTML = checks.map(c => `
                <div class="flex justify-between items-center text-sm">
                    <span>${c.name}</span>
                    <span class="${c.status ? 'status-ok' : 'status-error'}">${c.status ? 'âœ…' : 'âŒ'}</span>
                </div>
            `).join('');

            // å®‰è£ç‹€æ…‹
            const installable = checks.every(c => c.status);
            const installDiv = document.createElement('div');
            installDiv.className = 'mt-3 pt-3 border-t border-gray-700 text-center';
            installDiv.innerHTML = installable 
                ? '<span class="status-ok">âœ… å¯å®‰è£ç‚º App</span>'
                : '<span class="status-pending">âš ï¸ éƒ¨åˆ†åŠŸèƒ½ä¸å¯ç”¨</span>';
            container.appendChild(installDiv);
        }

        // åŸ·è¡Œæ‰€æœ‰æª¢æŸ¥
        async function runAllChecks() {
            document.getElementById('checkTime').textContent = `æª¢æŸ¥æ™‚é–“: ${new Date().toLocaleString()}`;
            
            checkPages();
            checkPWA();
            await checkAPIs();
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', runAllChecks);
    </script>
</body>
</html>
