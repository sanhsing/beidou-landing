<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ—æ–—æ•™è‚² | ç™»å…¥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-8X0VB6K9G7"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-8X0VB6K9G7');
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .gradient-bg {
            background: linear-gradient(135deg, #1e1e2e 0%, #2d1b4e 50%, #1e1e2e 100%);
        }
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .input-field {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s;
        }
        .input-field:focus {
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white flex items-center justify-center p-4">
    
    <div class="w-full max-w-md">
        <!-- Logo -->
        <div class="text-center mb-8">
            <a href="index.html" class="inline-block">
                <span class="text-4xl">ğŸŒŸ</span>
                <h1 class="text-2xl font-bold mt-2">åŒ—æ–—æ•™è‚²</h1>
                <p class="text-gray-400 text-sm">XTF æ¶ˆæ‹“èå­¸ç¿’ç³»çµ±</p>
            </a>
        </div>
        
        <!-- è¡¨å–®å¡ç‰‡ -->
        <div class="glass rounded-2xl p-8">
            <!-- åˆ‡æ›æ¨™ç±¤ -->
            <div class="flex mb-6 bg-white/5 rounded-lg p-1">
                <button id="tabLogin" onclick="switchTab('login')" 
                    class="flex-1 py-2 rounded-md text-sm font-medium transition tab-active">
                    ç™»å…¥
                </button>
                <button id="tabRegister" onclick="switchTab('register')" 
                    class="flex-1 py-2 rounded-md text-sm font-medium transition text-gray-400">
                    è¨»å†Š
                </button>
            </div>
            
            <!-- ç™»å…¥è¡¨å–® -->
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Email</label>
                        <input type="email" id="loginEmail" required
                            class="input-field w-full px-4 py-3 rounded-lg text-white outline-none"
                            placeholder="your@email.com">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">å¯†ç¢¼</label>
                        <input type="password" id="loginPassword" required
                            class="input-field w-full px-4 py-3 rounded-lg text-white outline-none"
                            placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    </div>
                    <div class="flex items-center justify-between text-sm">
                        <label class="flex items-center text-gray-400">
                            <input type="checkbox" class="mr-2 rounded">
                            è¨˜ä½æˆ‘
                        </label>
                        <a href="#" class="text-purple-400 hover:text-purple-300">å¿˜è¨˜å¯†ç¢¼ï¼Ÿ</a>
                    </div>
                    <button type="submit" id="loginBtn"
                        class="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 py-3 rounded-lg font-medium transition">
                        ç™»å…¥
                    </button>
                </div>
            </form>
            
            <!-- è¨»å†Šè¡¨å–® -->
            <form id="registerForm" onsubmit="handleRegister(event)" class="hidden">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">ç”¨æˆ¶å</label>
                        <input type="text" id="regUsername" required
                            class="input-field w-full px-4 py-3 rounded-lg text-white outline-none"
                            placeholder="ä½ çš„æš±ç¨±">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Email</label>
                        <input type="email" id="regEmail" required
                            class="input-field w-full px-4 py-3 rounded-lg text-white outline-none"
                            placeholder="your@email.com">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">å¯†ç¢¼</label>
                        <input type="password" id="regPassword" required minlength="6"
                            class="input-field w-full px-4 py-3 rounded-lg text-white outline-none"
                            placeholder="è‡³å°‘ 6 å€‹å­—å…ƒ">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">å¹´ç´š</label>
                        <select id="regGrade"
                            class="input-field w-full px-4 py-3 rounded-lg text-white outline-none">
                            <option value="é«˜ä¸€">é«˜ä¸€</option>
                            <option value="é«˜äºŒ">é«˜äºŒ</option>
                            <option value="é«˜ä¸‰">é«˜ä¸‰</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">æ¨è–¦ç¢¼ (é¸å¡«)</label>
                        <input type="text" id="regReferral"
                            class="input-field w-full px-4 py-3 rounded-lg text-white outline-none"
                            placeholder="æœ‹å‹çš„æ¨è–¦ç¢¼">
                    </div>
                    <button type="submit" id="registerBtn"
                        class="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 py-3 rounded-lg font-medium transition">
                        è¨»å†Š
                    </button>
                </div>
            </form>
            
            <!-- éŒ¯èª¤è¨Šæ¯ -->
            <div id="errorMsg" class="hidden mt-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg text-red-300 text-sm"></div>
            
            <!-- æˆåŠŸè¨Šæ¯ -->
            <div id="successMsg" class="hidden mt-4 p-3 bg-green-500/20 border border-green-500/50 rounded-lg text-green-300 text-sm"></div>
            
            <!-- åˆ†éš”ç·š -->
            <div class="flex items-center my-6">
                <div class="flex-1 border-t border-gray-700"></div>
                <span class="px-4 text-gray-500 text-sm">æˆ–</span>
                <div class="flex-1 border-t border-gray-700"></div>
            </div>
            
            <!-- è¨ªå®¢æ¨¡å¼ -->
            <button onclick="guestMode()" 
                class="w-full border border-gray-600 text-gray-300 hover:bg-white/5 py-3 rounded-lg font-medium transition">
                ğŸ‘¤ ä»¥è¨ªå®¢èº«ä»½ç¹¼çºŒ
            </button>
        </div>
        
        <!-- åº•éƒ¨é€£çµ -->
        <div class="text-center mt-6 text-sm text-gray-500">
            <a href="index.html" class="hover:text-purple-400">â† è¿”å›é¦–é </a>
        </div>
    </div>

    <script>
        const API_BASE = 'https://beidou-edu-server-1.onrender.com/api';
        
        // åˆ‡æ›æ¨™ç±¤
        function switchTab(tab) {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const tabLogin = document.getElementById('tabLogin');
            const tabRegister = document.getElementById('tabRegister');
            
            hideMessages();
            
            if (tab === 'login') {
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
                tabLogin.classList.add('bg-purple-600', 'text-white');
                tabLogin.classList.remove('text-gray-400');
                tabRegister.classList.remove('bg-purple-600', 'text-white');
                tabRegister.classList.add('text-gray-400');
            } else {
                loginForm.classList.add('hidden');
                registerForm.classList.remove('hidden');
                tabRegister.classList.add('bg-purple-600', 'text-white');
                tabRegister.classList.remove('text-gray-400');
                tabLogin.classList.remove('bg-purple-600', 'text-white');
                tabLogin.classList.add('text-gray-400');
            }
            
            // GA äº‹ä»¶
            gtag('event', 'switch_tab', {
                'event_category': 'auth',
                'event_label': tab
            });
        }
        
        // ç™»å…¥
        async function handleLogin(e) {
            e.preventDefault();
            hideMessages();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const btn = document.getElementById('loginBtn');
            
            btn.disabled = true;
            btn.textContent = 'ç™»å…¥ä¸­...';
            
            try {
                const res = await fetch(`${API_BASE}/user/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await res.json();
                
                if (data.success) {
                    // å„²å­˜ token
                    localStorage.setItem('beidou_token', data.data.token);
                    localStorage.setItem('beidou_user', JSON.stringify(data.data.user));
                    
                    showSuccess('ç™»å…¥æˆåŠŸï¼æ­£åœ¨è·³è½‰...');
                    
                    // GA äº‹ä»¶
                    gtag('event', 'login', {
                        'event_category': 'auth',
                        'event_label': 'success'
                    });
                    
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 1000);
                } else {
                    showError(data.error || 'ç™»å…¥å¤±æ•—');
                    gtag('event', 'login_failed', {
                        'event_category': 'auth',
                        'event_label': data.error
                    });
                }
            } catch (err) {
                showError('ç¶²è·¯éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦');
            }
            
            btn.disabled = false;
            btn.textContent = 'ç™»å…¥';
        }
        
        // è¨»å†Š
        async function handleRegister(e) {
            e.preventDefault();
            hideMessages();
            
            const username = document.getElementById('regUsername').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const grade = document.getElementById('regGrade').value;
            const referralCode = document.getElementById('regReferral').value;
            const btn = document.getElementById('registerBtn');
            
            btn.disabled = true;
            btn.textContent = 'è¨»å†Šä¸­...';
            
            try {
                const res = await fetch(`${API_BASE}/user/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password, username, grade, referralCode })
                });
                
                const data = await res.json();
                
                if (data.success) {
                    // å„²å­˜ token
                    localStorage.setItem('beidou_token', data.data.token);
                    localStorage.setItem('beidou_user', JSON.stringify(data.data.user));
                    
                    showSuccess('è¨»å†ŠæˆåŠŸï¼æ­£åœ¨è·³è½‰...');
                    
                    // GA äº‹ä»¶
                    gtag('event', 'sign_up', {
                        'event_category': 'auth',
                        'event_label': 'success'
                    });
                    
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 1000);
                } else {
                    showError(data.error || 'è¨»å†Šå¤±æ•—');
                }
            } catch (err) {
                showError('ç¶²è·¯éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦');
            }
            
            btn.disabled = false;
            btn.textContent = 'è¨»å†Š';
        }
        
        // è¨ªå®¢æ¨¡å¼
        function guestMode() {
            localStorage.setItem('beidou_guest', 'true');
            gtag('event', 'guest_mode', {
                'event_category': 'auth'
            });
            window.location.href = 'quiz_ui.html';
        }
        
        // è¨Šæ¯é¡¯ç¤º
        function showError(msg) {
            document.getElementById('errorMsg').textContent = msg;
            document.getElementById('errorMsg').classList.remove('hidden');
        }
        
        function showSuccess(msg) {
            document.getElementById('successMsg').textContent = msg;
            document.getElementById('successMsg').classList.remove('hidden');
        }
        
        function hideMessages() {
            document.getElementById('errorMsg').classList.add('hidden');
            document.getElementById('successMsg').classList.add('hidden');
        }
        
        // æª¢æŸ¥æ˜¯å¦å·²ç™»å…¥
        document.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('beidou_token');
            if (token) {
                window.location.href = 'dashboard.html';
            }
            
            // åˆå§‹åŒ–æ¨™ç±¤æ¨£å¼
            document.getElementById('tabLogin').classList.add('bg-purple-600', 'text-white');
        });
    </script>
</body>
</html>
