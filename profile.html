<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å€‹äººä¸­å¿ƒ - åŒ—æ–—æ•™è‚²</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    body { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); min-height: 100vh; }
    .card { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
    .stat-card { transition: transform 0.2s; }
    .stat-card:hover { transform: translateY(-5px); }
    .achievement { opacity: 0.4; }
    .achievement.unlocked { opacity: 1; }
    .progress-ring { transform: rotate(-90deg); }
  </style>
</head>
<body class="text-white p-4">
  <div class="container mx-auto max-w-4xl">
    <!-- é ­éƒ¨ -->
    <div class="flex items-center justify-between mb-6">
      <a href="index.html" class="text-gray-400 hover:text-white">â† è¿”å›é¦–é </a>
      <h1 class="text-2xl font-bold">ğŸ‘¤ å€‹äººä¸­å¿ƒ</h1>
      <div></div>
    </div>

    <!-- ç©å®¶è³‡è¨Šå¡ -->
    <div class="card rounded-2xl p-6 mb-6">
      <div class="flex items-center gap-4 mb-4">
        <div class="w-20 h-20 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center text-4xl">
          ğŸ§‘â€ğŸ“
        </div>
        <div class="flex-1">
          <div class="flex items-center gap-2">
            <h2 id="playerName" class="text-2xl font-bold">å­¸ç¿’è€…</h2>
            <span id="playerTitle" class="bg-yellow-500 text-black px-2 py-0.5 rounded text-xs">æ–°æ‰‹</span>
          </div>
          <div class="text-gray-400">Lv.<span id="playerLevel">1</span></div>
          <div class="mt-2 bg-gray-700 rounded-full h-2 overflow-hidden">
            <div id="expBar" class="bg-gradient-to-r from-green-400 to-emerald-500 h-full" style="width: 30%"></div>
          </div>
          <div class="text-xs text-gray-400 mt-1"><span id="currentExp">0</span> / <span id="nextLevelExp">100</span> EXP</div>
        </div>
      </div>
      
      <!-- è³‡æº -->
      <div class="grid grid-cols-3 gap-4 text-center">
        <div class="bg-black bg-opacity-30 rounded-xl p-3">
          <div class="text-2xl">ğŸ’°</div>
          <div id="coins" class="text-xl font-bold text-yellow-400">0</div>
          <div class="text-xs text-gray-400">é‡‘å¹£</div>
        </div>
        <div class="bg-black bg-opacity-30 rounded-xl p-3">
          <div class="text-2xl">ğŸ’</div>
          <div id="diamonds" class="text-xl font-bold text-cyan-400">0</div>
          <div class="text-xs text-gray-400">é‘½çŸ³</div>
        </div>
        <div class="bg-black bg-opacity-30 rounded-xl p-3">
          <div class="text-2xl">âš¡</div>
          <div id="energy" class="text-xl font-bold text-green-400">100</div>
          <div class="text-xs text-gray-400">é«”åŠ›</div>
        </div>
      </div>
    </div>

    <!-- çµ±è¨ˆæ•¸æ“š -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
      <div class="card stat-card rounded-xl p-4 text-center">
        <div class="text-3xl font-bold text-blue-400" id="totalQuestions">0</div>
        <div class="text-sm text-gray-400">ç­”é¡Œæ•¸</div>
      </div>
      <div class="card stat-card rounded-xl p-4 text-center">
        <div class="text-3xl font-bold text-green-400" id="accuracy">0%</div>
        <div class="text-sm text-gray-400">æ­£ç¢ºç‡</div>
      </div>
      <div class="card stat-card rounded-xl p-4 text-center">
        <div class="text-3xl font-bold text-purple-400" id="battlesWon">0</div>
        <div class="text-sm text-gray-400">æˆ°é¬¥å‹åˆ©</div>
      </div>
      <div class="card stat-card rounded-xl p-4 text-center">
        <div class="text-3xl font-bold text-orange-400" id="streak">0</div>
        <div class="text-sm text-gray-400">é€£çºŒç°½åˆ°</div>
      </div>
    </div>

    <!-- æˆå°±é è¦½ -->
    <div class="card rounded-2xl p-6 mb-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-bold">ğŸ† æˆå°±</h3>
        <a href="achievements.html" class="text-indigo-400 text-sm">æŸ¥çœ‹å…¨éƒ¨ â†’</a>
      </div>
      <div id="achievementList" class="grid grid-cols-5 gap-3">
        <!-- å‹•æ…‹ç”Ÿæˆ -->
      </div>
    </div>

    <!-- ç¨±è™Ÿé è¦½ -->
    <div class="card rounded-2xl p-6 mb-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-bold">ğŸ–ï¸ ç¨±è™Ÿ</h3>
        <button onclick="showTitles()" class="text-indigo-400 text-sm">ç®¡ç†ç¨±è™Ÿ â†’</button>
      </div>
      <div id="titleList" class="flex flex-wrap gap-2">
        <!-- å‹•æ…‹ç”Ÿæˆ -->
      </div>
    </div>

    <!-- å¿«æ·æ“ä½œ -->
    <div class="grid grid-cols-2 gap-4">
      <a href="battle.html" class="card rounded-xl p-4 text-center hover:bg-white hover:bg-opacity-10">
        <div class="text-3xl mb-2">âš”ï¸</div>
        <div class="font-bold">æ€ªç¸æˆ°é¬¥</div>
      </a>
      <a href="daily.html" class="card rounded-xl p-4 text-center hover:bg-white hover:bg-opacity-10">
        <div class="text-3xl mb-2">ğŸ“…</div>
        <div class="font-bold">æ¯æ—¥ä»»å‹™</div>
      </a>
      <a href="leaderboard.html" class="card rounded-xl p-4 text-center hover:bg-white hover:bg-opacity-10">
        <div class="text-3xl mb-2">ğŸ…</div>
        <div class="font-bold">æ’è¡Œæ¦œ</div>
      </a>
      <a href="wrong_book.html" class="card rounded-xl p-4 text-center hover:bg-white hover:bg-opacity-10">
        <div class="text-3xl mb-2">ğŸ“•</div>
        <div class="font-bold">éŒ¯é¡Œæœ¬</div>
      </a>
    </div>
  </div>

  <script>
    const API_BASE = 'https://beidou-edu-server-1.onrender.com';
    const PLAYER_ID = localStorage.getItem('player_id') || 1;

    async function loadProfile() {
      try {
        // è¼‰å…¥ç©å®¶è³‡æ–™
        const playerRes = await fetch(`${API_BASE}/api/player/${PLAYER_ID}`);
        const playerData = await playerRes.json();
        if (playerData.success) {
          const p = playerData.data;
          document.getElementById('playerName').textContent = p.display_name || 'å­¸ç¿’è€…';
          document.getElementById('playerLevel').textContent = p.level || 1;
          document.getElementById('coins').textContent = p.coins || 0;
          document.getElementById('diamonds').textContent = p.diamonds || 0;
          document.getElementById('currentExp').textContent = p.exp || 0;
          const expPct = ((p.exp || 0) / (p.next_level_exp || 100)) * 100;
          document.getElementById('expBar').style.width = expPct + '%';
        }

        // è¼‰å…¥çµ±è¨ˆ
        const statsRes = await fetch(`${API_BASE}/api/player/${PLAYER_ID}/stats`);
        const statsData = await statsRes.json();
        if (statsData.success) {
          const s = statsData.data;
          document.getElementById('totalQuestions').textContent = s.questions_answered || 0;
          document.getElementById('accuracy').textContent = (s.accuracy || 0) + '%';
          document.getElementById('battlesWon').textContent = s.battles_won || 0;
        }

        // è¼‰å…¥æ¯æ—¥ç‹€æ…‹
        const dailyRes = await fetch(`${API_BASE}/api/daily/status?player_id=${PLAYER_ID}`);
        const dailyData = await dailyRes.json();
        if (dailyData.success) {
          document.getElementById('streak').textContent = dailyData.data.streak || 0;
        }

        // è¼‰å…¥æˆå°±
        const achieveRes = await fetch(`${API_BASE}/api/player/${PLAYER_ID}/achievements`);
        const achieveData = await achieveRes.json();
        if (achieveData.success) {
          renderAchievements(achieveData.data.slice(0, 10));
        }

        // è¼‰å…¥ç¨±è™Ÿ
        const titlesRes = await fetch(`${API_BASE}/api/player/${PLAYER_ID}/titles`);
        const titlesData = await titlesRes.json();
        if (titlesData.success) {
          renderTitles(titlesData.data.filter(t => t.unlocked_at));
        }

      } catch (err) {
        console.error('è¼‰å…¥å¤±æ•—:', err);
      }
    }

    function renderAchievements(achievements) {
      const container = document.getElementById('achievementList');
      container.innerHTML = achievements.map(a => `
        <div class="achievement ${a.unlocked_at ? 'unlocked' : ''} bg-black bg-opacity-30 rounded-xl p-3 text-center" title="${a.name}">
          <div class="text-2xl">${a.icon || 'ğŸ†'}</div>
        </div>
      `).join('');
    }

    function renderTitles(titles) {
      const container = document.getElementById('titleList');
      if (titles.length === 0) {
        container.innerHTML = '<span class="text-gray-500">å°šç„¡ç¨±è™Ÿ</span>';
        return;
      }
      const rarityColors = {
        'common': 'bg-gray-600',
        'rare': 'bg-blue-600',
        'epic': 'bg-purple-600',
        'legendary': 'bg-yellow-600'
      };
      container.innerHTML = titles.map(t => `
        <span class="${rarityColors[t.rarity] || 'bg-gray-600'} px-3 py-1 rounded-full text-sm">
          ${t.name}
        </span>
      `).join('');
    }

    loadProfile();
  </script>
</body>
</html>
