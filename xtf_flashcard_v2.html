<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XTF è¤‡ç¿’å¡ v2 - åŒ—æ–—æ•™è‚²</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="js/api.js"></script>
    <style>
        .flip-card { perspective: 1000px; }
        .flip-card-inner { transition: transform 0.6s; transform-style: preserve-3d; }
        .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
        .flip-card-front, .flip-card-back { backface-visibility: hidden; }
        .flip-card-back { transform: rotateY(180deg); }
        .stage-s { background: linear-gradient(135deg, #dc2626, #ea580c); }
        .stage-t { background: linear-gradient(135deg, #059669, #0d9488); }
        .stage-f { background: linear-gradient(135deg, #2563eb, #7c3aed); }
        .glass { background: rgba(255,255,255,0.05); backdrop-filter: blur(10px); }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen text-white">
    
    <!-- Header -->
    <header class="bg-black/30 backdrop-blur-md border-b border-white/10 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <a href="index.html" class="text-2xl">â­</a>
                <span class="text-xl font-bold">åŒ—æ–—æ•™è‚²</span>
                <span class="text-sm text-purple-300">XTF è¤‡ç¿’å¡ v2</span>
            </div>
            <div class="flex items-center gap-4 text-sm">
                <span id="statsInfo" class="text-purple-300">è¼‰å…¥ä¸­...</span>
                <a href="xtf_starmap.html" class="bg-white/10 px-3 py-1 rounded-full hover:bg-white/20">æ˜Ÿåœ–</a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto px-4 py-8">
        
        <!-- é¡å‹é¸æ“‡ -->
        <section class="mb-6">
            <div class="flex flex-wrap gap-2 justify-center">
                <button onclick="setType('all')" id="typeAll" class="type-btn px-4 py-2 rounded-full bg-purple-600 text-white text-sm">
                    ğŸŒŸ å…¨éƒ¨
                </button>
                <button onclick="setType('gsat')" id="typeGsat" class="type-btn px-4 py-2 rounded-full bg-white/10 text-white text-sm">
                    ğŸ“š å­¸æ¸¬
                </button>
                <button onclick="setType('ai')" id="typeAi" class="type-btn px-4 py-2 rounded-full bg-white/10 text-white text-sm">
                    ğŸ¤– AIèªè­‰
                </button>
            </div>
        </section>

        <!-- ç§‘ç›®/èªè­‰ç¯©é¸ -->
        <section id="filterSection" class="mb-6">
            <div id="gsatFilters" class="flex flex-wrap gap-2 justify-center hidden">
                <button onclick="setSubject('æ•¸å­¸')" class="subj-btn px-3 py-1 rounded-full bg-white/10 text-sm">ğŸ“ æ•¸å­¸</button>
                <button onclick="setSubject('ç‰©ç†')" class="subj-btn px-3 py-1 rounded-full bg-white/10 text-sm">âš›ï¸ ç‰©ç†</button>
                <button onclick="setSubject('åŒ–å­¸')" class="subj-btn px-3 py-1 rounded-full bg-white/10 text-sm">ğŸ§ª åŒ–å­¸</button>
                <button onclick="setSubject('ç”Ÿç‰©')" class="subj-btn px-3 py-1 rounded-full bg-white/10 text-sm">ğŸ§¬ ç”Ÿç‰©</button>
                <button onclick="setSubject('åœ‹æ–‡')" class="subj-btn px-3 py-1 rounded-full bg-white/10 text-sm">ğŸ“œ åœ‹æ–‡</button>
                <button onclick="setSubject('è‹±æ–‡')" class="subj-btn px-3 py-1 rounded-full bg-white/10 text-sm">ğŸ”¤ è‹±æ–‡</button>
            </div>
            <div id="aiFilters" class="flex flex-wrap gap-2 justify-center hidden">
                <button onclick="setCert('G_')" class="cert-btn px-3 py-1 rounded-full bg-white/10 text-sm">ğŸ”µ Google</button>
                <button onclick="setCert('A_')" class="cert-btn px-3 py-1 rounded-full bg-white/10 text-sm">ğŸŸ  AWS</button>
                <button onclick="setCert('AZ_')" class="cert-btn px-3 py-1 rounded-full bg-white/10 text-sm">ğŸ”· Azure</button>
                <button onclick="setCert('CORE_')" class="cert-btn px-3 py-1 rounded-full bg-white/10 text-sm">âš™ï¸ Core</button>
            </div>
        </section>

        <!-- å­—å¡å€ -->
        <section id="cardArea" class="mb-8">
            <div class="flip-card w-full h-96 cursor-pointer" onclick="flipCard()">
                <div class="flip-card-inner w-full h-full relative">
                    <!-- Front (å•é¡Œé¢) -->
                    <div class="flip-card-front absolute w-full h-full bg-gradient-to-br from-purple-600 to-indigo-700 rounded-2xl p-8 flex flex-col justify-center items-center border border-white/20 shadow-xl">
                        <div class="text-sm text-purple-200 mb-2" id="cardType">é¡å‹</div>
                        <div class="text-lg text-purple-100 mb-2" id="cardId">ç¯€é» ID</div>
                        <div class="text-3xl font-bold text-center mb-4" id="cardName">ç¯€é»åç¨±</div>
                        <div class="text-5xl mt-4">â“</div>
                        <div class="text-sm text-purple-200 mt-6">é»æ“Šç¿»è½‰æŸ¥çœ‹ XTF å…§å®¹</div>
                    </div>
                    <!-- Back (ç­”æ¡ˆé¢) -->
                    <div class="flip-card-back absolute w-full h-full bg-slate-800 rounded-2xl border border-white/20 shadow-xl overflow-hidden">
                        <!-- XTF æ¨™ç±¤ -->
                        <div class="flex">
                            <button onclick="event.stopPropagation(); setStage('s')" id="tabS" class="flex-1 py-3 stage-s text-white font-medium text-sm">
                                ğŸ”» æ¶ˆ Simplify
                            </button>
                            <button onclick="event.stopPropagation(); setStage('t')" id="tabT" class="flex-1 py-3 bg-gray-700 text-gray-400 text-sm">
                                ğŸ”€ æ‹“ Transform
                            </button>
                            <button onclick="event.stopPropagation(); setStage('f')" id="tabF" class="flex-1 py-3 bg-gray-700 text-gray-400 text-sm">
                                ğŸ”º è Fuse
                            </button>
                        </div>
                        <!-- å…§å®¹å€ -->
                        <div class="p-6 h-80 overflow-y-auto">
                            <!-- æ¶ˆ -->
                            <div id="stageS" class="space-y-4">
                                <div class="bg-red-900/30 rounded-xl p-4 border-l-4 border-red-500">
                                    <div class="text-xs text-red-400 mb-1">ğŸ“– å®šç¾© Definition</div>
                                    <p id="xtfDef" class="text-white">-</p>
                                </div>
                                <div class="bg-orange-900/30 rounded-xl p-4 border-l-4 border-orange-500">
                                    <div class="text-xs text-orange-400 mb-1">ğŸ’¬ ç™½è©± Plain</div>
                                    <p id="xtfPlain" class="text-orange-100">-</p>
                                </div>
                                <div class="bg-yellow-900/30 rounded-xl p-4 border-l-4 border-yellow-500">
                                    <div class="text-xs text-yellow-400 mb-1">ğŸ­ æ¯”å–» Analogy</div>
                                    <p id="xtfAnalogy" class="text-yellow-100 italic">-</p>
                                </div>
                            </div>
                            <!-- æ‹“ -->
                            <div id="stageT" class="space-y-4 hidden">
                                <div class="bg-green-900/30 rounded-xl p-4 border-l-4 border-green-500">
                                    <div class="text-xs text-green-400 mb-1">ğŸ“‹ å‰ç½®çŸ¥è­˜ Prerequisites</div>
                                    <p id="xtfPrereq" class="text-green-100">-</p>
                                </div>
                                <div class="bg-yellow-900/30 rounded-xl p-4 border-l-4 border-yellow-500">
                                    <div class="text-xs text-yellow-400 mb-1">âš ï¸ æ˜“æ··æ·† Confused With</div>
                                    <p id="xtfConfused" class="text-yellow-100">-</p>
                                </div>
                            </div>
                            <!-- è -->
                            <div id="stageF" class="space-y-4 hidden">
                                <div class="bg-blue-900/30 rounded-xl p-4 border-l-4 border-blue-500">
                                    <div class="text-xs text-blue-400 mb-1">ğŸ¯ è€ƒè©¦æŠ€å·§ Exam Tips</div>
                                    <p id="xtfTips" class="text-blue-100">-</p>
                                </div>
                                <div class="bg-purple-900/30 rounded-xl p-4 border-l-4 border-purple-500">
                                    <div class="text-xs text-purple-400 mb-1">ğŸ“ å£è¨£ Mnemonic</div>
                                    <p id="xtfMnem" class="text-purple-200 font-bold text-lg">-</p>
                                </div>
                                <div class="bg-cyan-900/30 rounded-xl p-4 border-l-4 border-cyan-500">
                                    <div class="text-xs text-cyan-400 mb-1">ğŸŒ å¯¦å‹™æ‡‰ç”¨ Real World</div>
                                    <p id="xtfReal" class="text-cyan-100">-</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- æ“ä½œæŒ‰éˆ• -->
        <section class="flex justify-center gap-4 mb-8">
            <button onclick="prevCard()" class="px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-xl flex items-center gap-2">
                â¬…ï¸ ä¸Šä¸€å¼µ
            </button>
            <button onclick="loadRandomCard()" class="px-8 py-3 bg-purple-600 hover:bg-purple-500 rounded-xl flex items-center gap-2 font-bold">
                ğŸ”„ éš¨æ©ŸæŠ½å¡
            </button>
            <button onclick="nextCard()" class="px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-xl flex items-center gap-2">
                ä¸‹ä¸€å¼µ â¡ï¸
            </button>
        </section>

        <!-- é€²åº¦é¡¯ç¤º -->
        <section class="glass rounded-2xl p-6 text-center">
            <div class="text-sm text-gray-400 mb-2">ä»Šæ—¥å­¸ç¿’é€²åº¦</div>
            <div class="flex justify-center gap-8">
                <div>
                    <div class="text-3xl font-bold text-purple-400" id="todayCount">0</div>
                    <div class="text-xs text-gray-500">å·²è¤‡ç¿’</div>
                </div>
                <div>
                    <div class="text-3xl font-bold text-green-400" id="totalNodes">0</div>
                    <div class="text-xs text-gray-500">ç¯€é»ç¸½æ•¸</div>
                </div>
            </div>
        </section>
    </main>

    <script>
    // ç‹€æ…‹
    let currentType = 'all';
    let currentSubject = null;
    let currentCert = null;
    let currentNode = null;
    let currentStage = 's';
    let isFlipped = false;
    let todayCount = 0;
    let cardHistory = [];
    let historyIndex = -1;

    // åˆå§‹åŒ–
    async function init() {
        try {
            const stats = await BeidouAPI.xtfV2.stats();
            if (stats.success) {
                document.getElementById('totalNodes').textContent = stats.stats.total;
                document.getElementById('statsInfo').textContent = `${stats.stats.total} ç¯€é»`;
            }
        } catch (err) {
            console.error('è¼‰å…¥çµ±è¨ˆå¤±æ•—:', err);
        }
        loadRandomCard();
    }

    // è¨­å®šé¡å‹
    function setType(type) {
        currentType = type;
        currentSubject = null;
        currentCert = null;
        
        document.querySelectorAll('.type-btn').forEach(btn => {
            btn.classList.remove('bg-purple-600');
            btn.classList.add('bg-white/10');
        });
        document.getElementById('type' + type.charAt(0).toUpperCase() + type.slice(1)).classList.add('bg-purple-600');
        document.getElementById('type' + type.charAt(0).toUpperCase() + type.slice(1)).classList.remove('bg-white/10');

        // é¡¯ç¤ºå°æ‡‰ç¯©é¸å™¨
        document.getElementById('gsatFilters').classList.toggle('hidden', type !== 'gsat');
        document.getElementById('aiFilters').classList.toggle('hidden', type !== 'ai');

        loadRandomCard();
    }

    function setSubject(subj) {
        currentSubject = subj;
        loadRandomCard();
    }

    function setCert(cert) {
        currentCert = cert;
        loadRandomCard();
    }

    // è¼‰å…¥éš¨æ©Ÿå¡ç‰‡
    async function loadRandomCard() {
        try {
            const params = { type: currentType, count: 1 };
            if (currentSubject) params.subject = currentSubject;
            if (currentCert) params.cert = currentCert;

            const result = await BeidouAPI.xtfV2.random(params);
            if (result.success && result.nodes.length > 0) {
                currentNode = result.nodes[0];
                cardHistory.push(currentNode);
                historyIndex = cardHistory.length - 1;
                renderCard();
                todayCount++;
                document.getElementById('todayCount').textContent = todayCount;
            }
        } catch (err) {
            console.error('è¼‰å…¥å¡ç‰‡å¤±æ•—:', err);
        }

        // é‡ç½®ç¿»è½‰ç‹€æ…‹
        if (isFlipped) flipCard();
    }

    // æ¸²æŸ“å¡ç‰‡
    function renderCard() {
        if (!currentNode) return;
        const n = currentNode;

        // æ­£é¢
        document.getElementById('cardType').textContent = n.type === 'ai' ? `ğŸ¤– ${n.cert}` : `ğŸ“š ${n.subject}`;
        document.getElementById('cardId').textContent = n.id;
        document.getElementById('cardName').textContent = n.name;

        // èƒŒé¢ XTF
        const xtf = n.xtf || { s: {}, t: {}, f: {} };
        document.getElementById('xtfDef').textContent = xtf.s?.def || '-';
        document.getElementById('xtfPlain').textContent = xtf.s?.plain || '-';
        document.getElementById('xtfAnalogy').textContent = xtf.s?.analogy || '-';
        document.getElementById('xtfPrereq').textContent = xtf.t?.prereq || '-';
        document.getElementById('xtfConfused').textContent = xtf.t?.confused || '-';
        document.getElementById('xtfTips').textContent = xtf.f?.tips || '-';
        document.getElementById('xtfMnem').textContent = xtf.f?.mnem || '-';
        document.getElementById('xtfReal').textContent = xtf.f?.real || '-';

        setStage('s');
    }

    // ç¿»è½‰å¡ç‰‡
    function flipCard() {
        isFlipped = !isFlipped;
        document.querySelector('.flip-card').classList.toggle('flipped', isFlipped);
    }

    // è¨­å®š XTF éšæ®µ
    function setStage(stage) {
        currentStage = stage;
        ['s', 't', 'f'].forEach(s => {
            document.getElementById('stage' + s.toUpperCase()).classList.toggle('hidden', s !== stage);
            const tab = document.getElementById('tab' + s.toUpperCase());
            const stages = { s: 'stage-s', t: 'stage-t', f: 'stage-f' };
            tab.className = s === stage
                ? `flex-1 py-3 ${stages[s]} text-white font-medium text-sm`
                : 'flex-1 py-3 bg-gray-700 text-gray-400 text-sm';
        });
    }

    // ä¸Šä¸‹å¼µ
    function prevCard() {
        if (historyIndex > 0) {
            historyIndex--;
            currentNode = cardHistory[historyIndex];
            renderCard();
            if (isFlipped) flipCard();
        }
    }

    function nextCard() {
        if (historyIndex < cardHistory.length - 1) {
            historyIndex++;
            currentNode = cardHistory[historyIndex];
            renderCard();
            if (isFlipped) flipCard();
        } else {
            loadRandomCard();
        }
    }

    // éµç›¤å¿«æ·éµ
    document.addEventListener('keydown', (e) => {
        if (e.key === ' ' || e.key === 'Enter') flipCard();
        if (e.key === 'ArrowLeft') prevCard();
        if (e.key === 'ArrowRight') nextCard();
        if (e.key === 'r' || e.key === 'R') loadRandomCard();
        if (e.key === '1') setStage('s');
        if (e.key === '2') setStage('t');
        if (e.key === '3') setStage('f');
    });

    init();
    </script>
</body>
</html>
