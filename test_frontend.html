<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å‰ç«¯æ¨¡çµ„æ¸¬è©¦</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="js/components.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    .test-card { border: 2px solid #e5e7eb; margin: 1rem 0; }
    .test-card.pass { border-color: #22c55e; }
    .test-card.fail { border-color: #ef4444; }
    .chart-box { height: 200px; }
  </style>
</head>
<body class="bg-gray-100 p-8">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-2xl font-bold mb-6">ğŸ§ª åŒ—æ–—æ•™è‚²å‰ç«¯æ¸¬è©¦</h1>
    
    <!-- æ¨¡çµ„è¼‰å…¥æ¸¬è©¦ -->
    <div class="card test-card" id="test1">
      <h2 class="card-title">1. æ¨¡çµ„è¼‰å…¥æ¸¬è©¦</h2>
      <div id="moduleStatus" class="mt-2"></div>
    </div>

    <!-- CSS çµ„ä»¶æ¸¬è©¦ -->
    <div class="card test-card" id="test2">
      <h2 class="card-title">2. CSS çµ„ä»¶æ¸¬è©¦</h2>
      <div class="grid grid-cols-2 gap-4 mt-4">
        <div class="stat-card">
          <div class="stat-icon">ğŸ“š</div>
          <div class="stat-content">
            <div class="stat-value">123</div>
            <div class="stat-label">çµ±è¨ˆå¡ç‰‡</div>
          </div>
        </div>
        <div class="stat-card success">
          <div class="stat-icon">âœ“</div>
          <div class="stat-content">
            <div class="stat-value">85%</div>
            <div class="stat-label">æˆåŠŸæ¨£å¼</div>
          </div>
        </div>
      </div>
      <div class="mt-4">
        <span class="badge badge-primary">Primary</span>
        <span class="badge badge-success">Success</span>
        <span class="badge badge-warning">Warning</span>
        <span class="badge badge-danger">Danger</span>
      </div>
      <div class="mt-4">
        <div class="progress-bar" style="width: 200px;">
          <div class="fill" style="width: 75%;"></div>
        </div>
      </div>
    </div>

    <!-- åœ–è¡¨æ¸¬è©¦ -->
    <div class="card test-card" id="test3">
      <h2 class="card-title">3. åœ–è¡¨çµ„ä»¶æ¸¬è©¦</h2>
      <div class="grid grid-cols-3 gap-4 mt-4">
        <div>
          <p class="text-sm text-gray-500 mb-2">ç’°å½¢åœ–</p>
          <div class="chart-box">
            <canvas id="ringChart"></canvas>
          </div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-2">æŸ±ç‹€åœ–</p>
          <div class="chart-box">
            <canvas id="barChart"></canvas>
          </div>
        </div>
        <div>
          <p class="text-sm text-gray-500 mb-2">æŠ˜ç·šåœ–</p>
          <div class="chart-box">
            <canvas id="lineChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- API æ¸¬è©¦ -->
    <div class="card test-card" id="test4">
      <h2 class="card-title">4. API æ¨¡çµ„æ¸¬è©¦</h2>
      <div id="apiStatus" class="mt-2"></div>
      <button onclick="testAPI()" class="btn btn-primary mt-4">åŸ·è¡Œ API æ¸¬è©¦</button>
    </div>

    <!-- æ¸¬è©¦çµæœ -->
    <div class="card mt-6 bg-gray-800 text-white">
      <h2 class="text-lg font-bold mb-2">ğŸ“Š æ¸¬è©¦çµæœ</h2>
      <div id="testSummary"></div>
    </div>
  </div>

  <script src="js/api.js"></script>
  <script src="js/charts.js"></script>
  <script>
    const results = { pass: 0, fail: 0, tests: [] };

    function log(name, pass, msg) {
      results.tests.push({ name, pass, msg });
      if (pass) results.pass++; else results.fail++;
    }

    function updateSummary() {
      document.getElementById('testSummary').innerHTML = `
        <p>âœ… é€šé: ${results.pass}</p>
        <p>âŒ å¤±æ•—: ${results.fail}</p>
        <p>ç¸½è¨ˆ: ${results.tests.length}</p>
      `;
    }

    // 1. æ¨¡çµ„è¼‰å…¥æ¸¬è©¦
    function testModules() {
      const el = document.getElementById('moduleStatus');
      let html = '';
      
      // BeidouAPI
      if (typeof BeidouAPI !== 'undefined') {
        html += '<p>âœ… BeidouAPI å·²è¼‰å…¥</p>';
        html += '<p class="text-sm text-gray-500 ml-4">- CONFIG.BASE_URL: ' + BeidouAPI.CONFIG.BASE_URL + '</p>';
        html += '<p class="text-sm text-gray-500 ml-4">- æ–¹æ³•: user, progress, answers, analytics, quiz, cert</p>';
        log('BeidouAPI', true, 'æ¨¡çµ„è¼‰å…¥æˆåŠŸ');
        document.getElementById('test1').classList.add('pass');
      } else {
        html += '<p>âŒ BeidouAPI æœªè¼‰å…¥</p>';
        log('BeidouAPI', false, 'æ¨¡çµ„æœªè¼‰å…¥');
        document.getElementById('test1').classList.add('fail');
      }
      
      // BeidouCharts
      if (typeof BeidouCharts !== 'undefined') {
        html += '<p>âœ… BeidouCharts å·²è¼‰å…¥</p>';
        html += '<p class="text-sm text-gray-500 ml-4">- æ–¹æ³•: progressRing, subjectBars, trendLine, radarChart</p>';
        log('BeidouCharts', true, 'æ¨¡çµ„è¼‰å…¥æˆåŠŸ');
      } else {
        html += '<p>âŒ BeidouCharts æœªè¼‰å…¥</p>';
        log('BeidouCharts', false, 'æ¨¡çµ„æœªè¼‰å…¥');
      }
      
      el.innerHTML = html;
    }

    // 2. CSS æ¸¬è©¦ (è¦–è¦ºç¢ºèª)
    function testCSS() {
      const card = document.querySelector('.stat-card');
      const computed = getComputedStyle(card);
      if (computed.borderLeftWidth === '4px') {
        log('CSS stat-card', true, 'æ¨£å¼æ­£ç¢º');
        document.getElementById('test2').classList.add('pass');
      } else {
        log('CSS stat-card', false, 'æ¨£å¼ç•°å¸¸');
        document.getElementById('test2').classList.add('fail');
      }
    }

    // 3. åœ–è¡¨æ¸¬è©¦
    function testCharts() {
      try {
        // ç’°å½¢åœ–
        BeidouCharts.progressRing('ringChart', 75);
        log('progressRing', true, 'ç’°å½¢åœ–æ¸²æŸ“æˆåŠŸ');
        
        // æŸ±ç‹€åœ–
        BeidouCharts.subjectBars('barChart', [
          { subject: 'æ•¸å­¸', mastery: 80 },
          { subject: 'ç‰©ç†', mastery: 65 },
          { subject: 'åŒ–å­¸', mastery: 72 }
        ]);
        log('subjectBars', true, 'æŸ±ç‹€åœ–æ¸²æŸ“æˆåŠŸ');
        
        // æŠ˜ç·šåœ–
        BeidouCharts.trendLine('lineChart', [
          { date: '12/15', value: 60 },
          { date: '12/16', value: 75 },
          { date: '12/17', value: 68 },
          { date: '12/18', value: 82 },
          { date: '12/19', value: 90 }
        ]);
        log('trendLine', true, 'æŠ˜ç·šåœ–æ¸²æŸ“æˆåŠŸ');
        
        document.getElementById('test3').classList.add('pass');
      } catch (e) {
        log('Charts', false, e.message);
        document.getElementById('test3').classList.add('fail');
      }
    }

    // 4. API æ¸¬è©¦
    async function testAPI() {
      const el = document.getElementById('apiStatus');
      el.innerHTML = '<p>æ¸¬è©¦ä¸­...</p>';
      
      let html = '';
      
      // æ¸¬è©¦ API çµæ§‹
      const apis = ['user', 'progress', 'answers', 'analytics', 'quiz', 'cert'];
      apis.forEach(api => {
        if (BeidouAPI[api]) {
          html += `<p>âœ… BeidouAPI.${api} å­˜åœ¨</p>`;
          log(`API.${api}`, true, 'æ–¹æ³•å­˜åœ¨');
        } else {
          html += `<p>âŒ BeidouAPI.${api} ä¸å­˜åœ¨</p>`;
          log(`API.${api}`, false, 'æ–¹æ³•ä¸å­˜åœ¨');
        }
      });
      
      // æ¸¬è©¦å¯¦éš›å‘¼å« (æœƒå¤±æ•—å› ç‚º CORSï¼Œä½†å¯é©—è­‰æ–¹æ³•)
      html += '<hr class="my-2">';
      html += '<p class="text-sm text-gray-500">è¨»: å¯¦éš› API å‘¼å«éœ€åœ¨éƒ¨ç½²ç’°å¢ƒæ¸¬è©¦</p>';
      
      el.innerHTML = html;
      document.getElementById('test4').classList.add('pass');
      updateSummary();
    }

    // åŸ·è¡Œæ¸¬è©¦
    window.onload = function() {
      testModules();
      testCSS();
      testCharts();
      updateSummary();
    };
  </script>
</body>
</html>
