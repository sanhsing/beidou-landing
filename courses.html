<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI èªè­‰èª²ç¨‹ - åŒ—æ–—æ•™è‚²</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="manifest" href="manifest.json">
    <style>
        .card { background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(139,92,246,0.3); }
        .provider-google { border-color: #4285f4; }
        .provider-aws { border-color: #ff9900; }
        .provider-azure { border-color: #0078d4; }
        .provider-ipas { border-color: #00a651; }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- é ‚éƒ¨å°èˆª -->
    <nav class="bg-gray-800/80 backdrop-blur border-b border-white/10 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
            <a href="index.html" class="text-xl font-bold text-purple-400">åŒ—æ–—æ•™è‚²</a>
            <div class="flex items-center gap-4">
                <a href="dashboard.html" class="text-gray-400 hover:text-white text-sm">å„€è¡¨æ¿</a>
                <span id="userInfo" class="text-sm text-gray-400"></span>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto px-4 py-8">
        <!-- Hero Section -->
        <section class="text-center mb-12">
            <h1 class="text-3xl md:text-4xl font-bold mb-4">
                ğŸ“ AI èªè­‰èª²ç¨‹
            </h1>
            <p class="text-gray-400 max-w-2xl mx-auto">
                å–å¾—å…¨çƒèªå¯çš„ AI èªè­‰ï¼Œæå‡è·å ´ç«¶çˆ­åŠ›ã€‚<br>
                å®Œæ•´å‚™è€ƒèª²ç¨‹ + é¡Œåº«ç·´ç¿’ + æ¨¡æ“¬æ¸¬é©—
            </p>
        </section>

        <!-- èª²ç¨‹åˆ—è¡¨ -->
        <section id="courseList" class="grid md:grid-cols-2 gap-6 mb-12">
            <div class="text-center py-8 text-gray-500">è¼‰å…¥ä¸­...</div>
        </section>

        <!-- æˆ‘çš„èª²ç¨‹ -->
        <section id="myCourses" class="hidden">
            <h2 class="text-2xl font-bold mb-6">ğŸ“š æˆ‘çš„èª²ç¨‹</h2>
            <div id="myCoursesGrid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
            </div>
        </section>

        <!-- ç‚ºä»€éº¼é¸æ“‡æˆ‘å€‘ -->
        <section class="bg-gray-800/50 rounded-2xl p-8 mb-12">
            <h2 class="text-2xl font-bold text-center mb-8">ç‚ºä»€éº¼é¸æ“‡åŒ—æ–—ï¼Ÿ</h2>
            <div class="grid md:grid-cols-3 gap-6">
                <div class="text-center">
                    <div class="text-4xl mb-3">ğŸ“–</div>
                    <h3 class="font-bold mb-2">å®Œæ•´èª²ç¨‹å…§å®¹</h3>
                    <p class="text-gray-400 text-sm">æ¶µè“‹æ‰€æœ‰è€ƒè©¦é‡é»ï¼Œç³»çµ±åŒ–å­¸ç¿’</p>
                </div>
                <div class="text-center">
                    <div class="text-4xl mb-3">ğŸ“</div>
                    <h3 class="font-bold mb-2">å¤§é‡é¡Œåº«ç·´ç¿’</h3>
                    <p class="text-gray-400 text-sm">æ¯é–€èª²ç¨‹ 150-200 é“ç·´ç¿’é¡Œ</p>
                </div>
                <div class="text-center">
                    <div class="text-4xl mb-3">ğŸ¯</div>
                    <h3 class="font-bold mb-2">æ¨¡æ“¬æ¸¬é©—</h3>
                    <p class="text-gray-400 text-sm">ä»¿çœŸè€ƒè©¦ç’°å¢ƒï¼Œæå‰é©æ‡‰</p>
                </div>
            </div>
        </section>

        <!-- FAQ -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold text-center mb-8">å¸¸è¦‹å•é¡Œ</h2>
            <div class="space-y-4 max-w-3xl mx-auto">
                <details class="bg-gray-800 rounded-lg p-4">
                    <summary class="font-bold cursor-pointer">èª²ç¨‹æœ‰æ•ˆæœŸå¤šé•·ï¼Ÿ</summary>
                    <p class="text-gray-400 mt-2">è³¼è²·å¾Œä¸€å¹´å…§æœ‰æ•ˆï¼ŒåŒ…å«æœŸé–“å…§çš„æ‰€æœ‰æ›´æ–°ã€‚</p>
                </details>
                <details class="bg-gray-800 rounded-lg p-4">
                    <summary class="font-bold cursor-pointer">Pro ç‰ˆæœ‰ä»€éº¼é¡å¤–åŠŸèƒ½ï¼Ÿ</summary>
                    <p class="text-gray-400 mt-2">Pro ç‰ˆåŒ…å« AI åŠ©æ•™ç­”ç–‘ã€ç„¡é™æ¬¡æ¨¡æ“¬æ¸¬é©—ã€èªè­‰è€ƒè©¦ä»£å ±åæŒ‡å°ç­‰é€²éšåŠŸèƒ½ã€‚</p>
                </details>
                <details class="bg-gray-800 rounded-lg p-4">
                    <summary class="font-bold cursor-pointer">å¯ä»¥é€€æ¬¾å—ï¼Ÿ</summary>
                    <p class="text-gray-400 mt-2">è³¼è²·å¾Œ 7 å¤©å…§ï¼Œè‹¥é€²åº¦ä½æ–¼ 20%ï¼Œå¯ç”³è«‹å…¨é¡é€€æ¬¾ã€‚</p>
                </details>
                <details class="bg-gray-800 rounded-lg p-4">
                    <summary class="font-bold cursor-pointer">å¦‚ä½•é–‹å§‹å­¸ç¿’ï¼Ÿ</summary>
                    <p class="text-gray-400 mt-2">è³¼è²·å¾Œç«‹å³å¯åœ¨ã€Œæˆ‘çš„èª²ç¨‹ã€ä¸­é–‹å§‹å­¸ç¿’ï¼Œæ”¯æ´é›»è…¦å’Œæ‰‹æ©Ÿã€‚</p>
                </details>
            </div>
        </section>
    </main>

    <!-- èª²ç¨‹è©³æƒ… Modal -->
    <div id="courseModal" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div id="modalContent"></div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="py-8 border-t border-gray-800">
        <div class="max-w-6xl mx-auto px-4 text-center text-gray-500 text-sm">
            <p>åŒ—æ–—ä¸ƒæ˜Ÿæ–‡å‰µæ•¸ä½æœ‰é™å…¬å¸ Â© 2025</p>
            <div class="mt-2">ğŸ“§ sanhsing@gmail.com</div>
        </div>
    </footer>

    <script>
        const API_BASE = 'https://beidou-edu-server-1.onrender.com';
        let currentUser = null;
        let courses = [];

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            loadCourses();
        });

        // æª¢æŸ¥ç™»å…¥
        function checkAuth() {
            const token = localStorage.getItem('beidou_token');
            const userData = localStorage.getItem('beidou_user');
            
            if (token && userData) {
                currentUser = JSON.parse(userData);
                document.getElementById('userInfo').textContent = currentUser.username || currentUser.email;
                loadMyCourses();
            }
        }

        // è¼‰å…¥èª²ç¨‹åˆ—è¡¨
        async function loadCourses() {
            try {
                const response = await fetch(`${API_BASE}/api/courses`);
                const result = await response.json();
                
                if (result.success) {
                    courses = result.data;
                    renderCourses(courses);
                }
            } catch (error) {
                console.error('Load courses error:', error);
                // Fallback éœæ…‹è³‡æ–™
                courses = [
                    { id: 'google-ai', name: 'Google AI Essentials', provider: 'Google', price: 199, proPrice: 399, description: 'Google å®˜æ–¹ AI åŸºç¤èªè­‰å‚™è€ƒèª²ç¨‹', duration: '8 å°æ™‚', questionCount: 150, badge: 'ğŸ–ï¸' },
                    { id: 'aws-ai', name: 'AWS AI Practitioner', provider: 'Amazon', price: 299, proPrice: 599, description: 'AWS èªè­‰ AI å¾æ¥­è€…å‚™è€ƒèª²ç¨‹', duration: '12 å°æ™‚', questionCount: 200, badge: 'ğŸ…' },
                    { id: 'azure-ai', name: 'Azure AI Fundamentals', provider: 'Microsoft', price: 299, proPrice: 599, description: 'Microsoft Azure AI-900 å‚™è€ƒèª²ç¨‹', duration: '10 å°æ™‚', questionCount: 180, badge: 'ğŸ¥‡' },
                    { id: 'ipas-security', name: 'iPAS è³‡è¨Šå®‰å…¨å·¥ç¨‹å¸«', provider: 'ç¶“æ¿Ÿéƒ¨', price: 149, proPrice: 299, description: 'ç¶“æ¿Ÿéƒ¨ iPAS è³‡å®‰èªè­‰å‚™è€ƒèª²ç¨‹', duration: '6 å°æ™‚', questionCount: 120, badge: 'ğŸ›¡ï¸' }
                ];
                renderCourses(courses);
            }
        }

        // æ¸²æŸ“èª²ç¨‹åˆ—è¡¨
        function renderCourses(courses) {
            const providerColors = {
                'Google': 'border-l-4 border-blue-500',
                'Amazon': 'border-l-4 border-yellow-500',
                'Microsoft': 'border-l-4 border-sky-500',
                'ç¶“æ¿Ÿéƒ¨': 'border-l-4 border-green-500'
            };
            
            const providerLogos = {
                'Google': 'ğŸ”µ',
                'Amazon': 'ğŸŸ ',
                'Microsoft': 'ğŸ”·',
                'ç¶“æ¿Ÿéƒ¨': 'ğŸŸ¢'
            };

            const html = courses.map(c => `
                <div class="card rounded-2xl overflow-hidden card-hover ${providerColors[c.provider] || ''}">
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <div class="text-sm text-gray-400 mb-1">${providerLogos[c.provider] || ''} ${c.provider}</div>
                                <h3 class="text-xl font-bold">${c.name}</h3>
                            </div>
                            <div class="text-3xl">${c.badge}</div>
                        </div>
                        
                        <p class="text-gray-400 text-sm mb-4">${c.description}</p>
                        
                        <div class="flex gap-4 text-sm text-gray-400 mb-6">
                            <span>â±ï¸ ${c.duration}</span>
                            <span>ğŸ“ ${c.questionCount} é¡Œ</span>
                        </div>
                        
                        <div class="flex items-end justify-between">
                            <div>
                                <div class="text-2xl font-bold text-purple-400">$${c.price}</div>
                                <div class="text-xs text-gray-500">Pro ç‰ˆ $${c.proPrice}</div>
                            </div>
                            <button onclick="showCourseDetail('${c.id}')" 
                                    class="bg-purple-600 hover:bg-purple-700 px-6 py-2 rounded-lg transition">
                                æŸ¥çœ‹è©³æƒ…
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('courseList').innerHTML = html;
        }

        // è¼‰å…¥æˆ‘çš„èª²ç¨‹
        async function loadMyCourses() {
            if (!currentUser) return;
            
            try {
                const response = await fetch(`${API_BASE}/api/courses/my/${currentUser.userId}`);
                const result = await response.json();
                
                if (result.success && result.data.length > 0) {
                    document.getElementById('myCourses').classList.remove('hidden');
                    renderMyCourses(result.data);
                }
            } catch (error) {
                console.error('Load my courses error:', error);
            }
        }

        // æ¸²æŸ“æˆ‘çš„èª²ç¨‹
        function renderMyCourses(myCourses) {
            const html = myCourses.map(c => `
                <div class="bg-gray-800 rounded-xl p-4 card-hover cursor-pointer" onclick="continueLearning('${c.id}')">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <div class="font-bold">${c.name}</div>
                            <div class="text-xs text-gray-400">${c.provider}</div>
                        </div>
                        <span class="text-xs bg-${c.tier === 'pro' ? 'yellow' : 'purple'}-600 px-2 py-1 rounded">
                            ${c.tier === 'pro' ? 'Pro' : 'æ¨™æº–'}
                        </span>
                    </div>
                    
                    <div class="mb-3">
                        <div class="flex justify-between text-xs text-gray-400 mb-1">
                            <span>å­¸ç¿’é€²åº¦</span>
                            <span>${c.progress}%</span>
                        </div>
                        <div class="bg-gray-700 rounded-full h-2">
                            <div class="bg-purple-500 h-2 rounded-full" style="width: ${c.progress}%"></div>
                        </div>
                    </div>
                    
                    <button class="w-full bg-green-600 hover:bg-green-700 py-2 rounded-lg text-sm transition">
                        ç¹¼çºŒå­¸ç¿’
                    </button>
                </div>
            `).join('');
            
            document.getElementById('myCoursesGrid').innerHTML = html;
        }

        // é¡¯ç¤ºèª²ç¨‹è©³æƒ…
        async function showCourseDetail(courseId) {
            const course = courses.find(c => c.id === courseId);
            if (!course) return;
            
            // å˜—è©¦å¾ API å–å¾—å®Œæ•´è³‡è¨Š
            let fullCourse = course;
            try {
                const response = await fetch(`${API_BASE}/api/courses/${courseId}`);
                const result = await response.json();
                if (result.success) {
                    fullCourse = result.data;
                }
            } catch (e) {}
            
            const html = `
                <div class="p-6">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <div class="text-sm text-gray-400 mb-1">${fullCourse.provider}</div>
                            <h2 class="text-2xl font-bold">${fullCourse.name}</h2>
                        </div>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
                    </div>
                    
                    <p class="text-gray-300 mb-6">${fullCourse.description}</p>
                    
                    <div class="grid grid-cols-3 gap-4 mb-6">
                        <div class="bg-gray-700/50 rounded-lg p-3 text-center">
                            <div class="text-2xl mb-1">â±ï¸</div>
                            <div class="text-sm">${fullCourse.duration}</div>
                        </div>
                        <div class="bg-gray-700/50 rounded-lg p-3 text-center">
                            <div class="text-2xl mb-1">ğŸ“</div>
                            <div class="text-sm">${fullCourse.questionCount} é¡Œ</div>
                        </div>
                        <div class="bg-gray-700/50 rounded-lg p-3 text-center">
                            <div class="text-2xl mb-1">ğŸ¯</div>
                            <div class="text-sm">${fullCourse.passingScore || 70}% åŠæ ¼</div>
                        </div>
                    </div>
                    
                    ${fullCourse.modules ? `
                    <div class="mb-6">
                        <h3 class="font-bold mb-3">ğŸ“š èª²ç¨‹å¤§ç¶±</h3>
                        <div class="space-y-2">
                            ${fullCourse.modules.map((m, i) => `
                                <div class="bg-gray-700/50 rounded-lg p-3 flex justify-between">
                                    <span>${i + 1}. ${m.name}</span>
                                    <span class="text-gray-400 text-sm">${m.duration}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}
                    
                    <!-- æ–¹æ¡ˆé¸æ“‡ -->
                    <div class="grid md:grid-cols-2 gap-4 mb-6">
                        <div class="border border-gray-600 rounded-xl p-4">
                            <div class="font-bold mb-2">æ¨™æº–ç‰ˆ</div>
                            <div class="text-2xl font-bold text-purple-400 mb-3">$${fullCourse.price}</div>
                            <ul class="text-sm text-gray-400 space-y-1 mb-4">
                                ${(fullCourse.features?.standard || ['å®Œæ•´èª²ç¨‹å…§å®¹', 'ç·´ç¿’é¡Œåº«', 'æ¨¡æ“¬æ¸¬é©— x2']).map(f => `<li>âœ“ ${f}</li>`).join('')}
                            </ul>
                            <button onclick="enrollCourse('${courseId}', 'standard')" 
                                    class="w-full bg-purple-600 hover:bg-purple-700 py-2 rounded-lg transition">
                                ç«‹å³è³¼è²·
                            </button>
                        </div>
                        
                        <div class="border border-yellow-500 rounded-xl p-4 relative">
                            <div class="absolute -top-3 left-4 bg-yellow-500 text-black text-xs px-2 py-1 rounded">æ¨è–¦</div>
                            <div class="font-bold mb-2">Pro ç‰ˆ</div>
                            <div class="text-2xl font-bold text-yellow-400 mb-3">$${fullCourse.proPrice}</div>
                            <ul class="text-sm text-gray-400 space-y-1 mb-4">
                                ${(fullCourse.features?.pro || ['æ¨™æº–ç‰ˆå…¨éƒ¨åŠŸèƒ½', 'AI åŠ©æ•™ç­”ç–‘', 'ç„¡é™æ¬¡æ¨¡æ“¬æ¸¬é©—', 'èªè­‰è€ƒè©¦ä»£å ±å']).map(f => `<li>âœ“ ${f}</li>`).join('')}
                            </ul>
                            <button onclick="enrollCourse('${courseId}', 'pro')" 
                                    class="w-full bg-yellow-500 hover:bg-yellow-600 text-black py-2 rounded-lg transition">
                                ç«‹å³è³¼è²·
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalContent').innerHTML = html;
            document.getElementById('courseModal').classList.remove('hidden');
            document.getElementById('courseModal').classList.add('flex');
        }

        // é—œé–‰ Modal
        function closeModal() {
            document.getElementById('courseModal').classList.add('hidden');
            document.getElementById('courseModal').classList.remove('flex');
        }

        // å ±åèª²ç¨‹
        async function enrollCourse(courseId, tier) {
            if (!currentUser) {
                if (confirm('è«‹å…ˆç™»å…¥æ‰èƒ½è³¼è²·èª²ç¨‹ï¼Œæ˜¯å¦å‰å¾€ç™»å…¥ï¼Ÿ')) {
                    window.location.href = `auth.html?redirect=courses.html`;
                }
                return;
            }
            
            try {
                // å»ºç«‹å ±å
                const enrollRes = await fetch(`${API_BASE}/api/courses/enroll`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: currentUser.userId,
                        courseId,
                        tier
                    })
                });
                
                const enrollResult = await enrollRes.json();
                
                if (!enrollResult.success) {
                    alert(enrollResult.error || 'å ±åå¤±æ•—');
                    return;
                }
                
                // å»ºç«‹ä»˜æ¬¾
                const course = courses.find(c => c.id === courseId);
                const price = tier === 'pro' ? course.proPrice : course.price;
                
                const payRes = await fetch(`${API_BASE}/api/payment/cert`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: currentUser.userId,
                        certId: courseId,
                        isPro: tier === 'pro'
                    })
                });
                
                const payResult = await payRes.json();
                
                if (payResult.success) {
                    // å°å‘ ECPay ä»˜æ¬¾
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = payResult.paymentUrl;
                    
                    for (const [key, value] of Object.entries(payResult.params)) {
                        const input = document.createElement('input');
                        input.type = 'hidden';
                        input.name = key;
                        input.value = value;
                        form.appendChild(input);
                    }
                    
                    document.body.appendChild(form);
                    form.submit();
                } else {
                    alert('ä»˜æ¬¾å»ºç«‹å¤±æ•—ï¼š' + payResult.error);
                }
            } catch (error) {
                alert('æ“ä½œå¤±æ•—ï¼š' + error.message);
            }
        }

        // ç¹¼çºŒå­¸ç¿’
        function continueLearning(courseId) {
            window.location.href = `course_learn.html?id=${courseId}`;
        }

        // é»æ“Š Modal å¤–éƒ¨é—œé–‰
        document.getElementById('courseModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('courseModal')) {
                closeModal();
            }
        });
    </script>
</body>
</html>
